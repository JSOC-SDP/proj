<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso-8859-1">
<TITLE>JSOC Lookdata</TITLE>

<!-- activewidgets fix box model in firefox/safari/opera -->
<style type="text/css">
        .aw-quirks * {
                box-sizing: border-box;
                -moz-box-sizing: border-box;
                -webkit-box-sizing: border-box;
        }

        // body {font: 12px Tahoma}
</style>

<SCRIPT TYPE="text/javascript" SRC="js/prototype-1.6.1.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/cookies.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/prototip.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/amCharts/swfobject.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/ActiveWidgets/runtime/lib/aw.js"></SCRIPT>
<LINK HREF="js/ActiveWidgets/runtime/styles/system/aw.css" rel="stylesheet">
<!-- add activewidgets image libraries -->
<link href="js/ActiveWidgets/mini.css" rel="stylesheet"></link>

<!-- activewidgets change default styles, set control size and position -->
<style type="text/css">

#LookdataTabs {width: 100%}
#LookdataTabs-item-0 {font-size: medium}
#LookdataTabs-item-1 {font-size: medium}
#LookdataTabs-item-2 {font-size: medium}
#LookdataTabs-item-3 {font-size: medium}
#LookdataTabs-item-4 {font-size: medium}
#LookdataTabs-item-5 {font-size: medium}

#ValueGrid { width: 400px}
#ValueGrid .aw-grid-row {height: 24px; border-bottom: 1px solid #bbb}
#ValueGrid .aw-alternate-even {background: #fcf4fc;}
#ValueGrid .aw-alternate-odd {background: #f8fcf8;}
#ValueGrid .aw-mouseover-row {background: #f0f0f0;} 
#ValueGrid .aw-rows-selected {background: #d3d3d3;}
#ValueGrid .aw-cells-selected {background: #e3e3e3;}
#ValueGrid .aw-cells-selected {color: #000000;}
#ValueGrid .aw-column-0 {width: 50px; border-right: 1px dotted #bbb;}
#ValueGrid .aw-grid-cell {font-family: "DejaVu Sans Mono",monospace; font-size: 12;}
#ValueGrid .aw-grid-header {font-family: "DejaVu Sans Mono",monospace; font-size: 12;}
#ValueGrid .aw-grid-header .aw-column-1 {font-weight: bold}

</style>

<link rel="stylesheet" type="text/css" href="css/prototip.css" ></link>

<style type="text/css">

#body { margin:0; padding:0; background:#ddf;}
#header { position:relative; top:0; left:0; width:100%; background:#eee; }
#footer { position:fixed; bottom:0; left:0; width:100%; background:#eee; }

#SeriesDiv { position:relative; margin:5px; }
#SeriesInfoDiv { position:relative; margin:5px; }
#MySeriesDiv { position:relative; margin:5px; }
#QueryDiv { position:relative; margin:5px; }
#FullInfoDiv { position:relative; margin:5px; }
#FullDisplayInfoDiv { position:relative; margin:5px; }

#SeriesSelect { width:40em; }
#KeysSelect { width:20em; }
#GraphKeysSelect { width:20em; }
#SegsSelect { width:20em; }
#LinksSelect { width:20em; }
#SeriesFilter { width:20em; }
#RecordSet { width:35em; font-size:100%; }
#SeriesButton { width:15em; }

#InfoTable { border-spacing:1px; white-space:nowrap; }
td {padding:2px; }

span.tip { background-color:yellow }

</style>
 
<script type="text/javascript">

// 
// Documents for the server side tools can be found at
// "http://jsoc.stanford.edu/jsocwiki/AjaxJsocConnect"
//

// Global variables and initialize page locations

// var SeriesList = "";
// var SeriesInfo = "";
var Host = location.host;
var CurrentSeries = 0;
var SeriesName = "";
var SeriesKeySegInfo = "";
var nprimes = 0;
var KeyList = "";
var SegList = "";
var nkeysselected = 0;
var nsegsselected = 0;
var RecordCount = 0;
var askedCount = 0;
var KeyValsFetched = 0;
var TipsEnabled=1;
var TabsEnabled=1;
var TipsCreated = 0;
var MaxRecs = 0;

var GetSeriesObject;
var GetValuesObject;
var valuegrid;
var valuegridlabel;
var gridmade = 0;
var CWide;
var CHeight;
var amCharOK = 0;
// var flashMovie = new Object();
var flashMovie;


// ActiveWidgets Tab setup
var tabnames = ["Series Select", "Series Content", "RecordSet Select", "Values Display", "Export Data", "Test"];
var tabvalues = ["TabSeriesSelectDiv",  "TabSeriesStructDiv", "TabRecSetDiv", "TabDisplayDiv", "TabExportDiv", "TabPlotDiv"];
var tabs = new AW.UI.Tabs;
var tabseries = 0;
var tabkeytable = 1;
var tabrecset = 2;
var tabdisplay = 3;
var tabexport = 4;
var tabplot = 5;

function definetabs()
        {
        tabs.setId("LookdataTabs");
        tabs.setItemText(tabnames);
        tabs.setItemValue(tabvalues); // store ids of content DIVs
        tabs.setItemCount(6);
        tabs.refresh();

        tabs.setSelectedItems([tabseries]); // load the first page.
        }

tabs.onSelectedItemsChanged = function(selected)
  {
  if (!TabsEnabled) return;
  var i, divs = $("JsocLookdata").childNodes;
  for(i=0; i < divs.length; i++)
    {
    if (divs[i].style)
      {
      divs[i].style.display = "none"; // hide all elements
      }
    }

  var index = selected[0];
  var value = this.getItemValue(index);
  // document.getElementById(value).style.display = "block"; // show selected
  $(value).style.display = "block"; // show selected
  }

function ToggleTabs()
  {
  if (TabsEnabled)
    {
    var i, divs = $("JsocLookdata").childNodes;
    for(i=0; i < divs.length; i++)
      {
      if (divs[i].style)
        {
        divs[i].style.display = "block"; // hide all elements
        }
      }
    $("TabsOnOffButton").value = "Enable Tabs";
    $("LookdataTabs").innerHTML = "";
    TabsEnabled = 0;
    }
  else
    {
    $("TabsOnOffButton").value = "Disable Tabs";
    TabsEnabled = 1;
    definetabs();
    }
  }

function InitPage()
  {
  $("SeriesFilter").value = "NOT ^dsds\\.";
  CleanSeriesSelect();
  // $("RequestID").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  // $("StatusLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  // $("StatusDataLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  $("QueryDivCheck").checked = 0;
  $("QueryDiv").style.display="none";
  // $("WhereClausesHelpDiv").style.display="none";
  // AbortGetKeyValues(); ---- do not do this here!!
  // GetSeriesAbort(); ---- do not do this here!!
  CleanSeriesSelect();
  // ClearStatus();
  }

function CleanSeriesSelect()
  {
  for (var i=$("SeriesSelect").length; i > 0; i--)
    {
    $("SeriesSelect").remove(i-1);
    }
  CleanSeriesInfo();
  }

function CleanSeriesInfo()
  {
  MaxRecs = 0;
  $("RecordLimit").value = "none";
  SeriesName = "";
  $("RecordSet").value = "";
  $("SeriesButton").disabled = false;
  $("FetchKeyValsButton").disabled = false;
  $("FetchKeyValsButton").value = "Fetch Keyword Values for RecordSet";
  $("FetchKeyValsButton").style.backgroundColor = "#FFFF80";
  $("Series_Info_Place").innerHTML = "";
  $("Series_Name_Place").innerHTML = "";
  $("FirstLastPlace").innerHTML = "";
  $("SeriesCountPlace").innerHTML = "<I>TBD</I>";
  CleanSeriesPick();
  }

function CleanSeriesPick()
  {
  $("KeyListPlace").innerHTML = "All Keywords";
  $("SegListPlace").innerHTML = "All Segments";
  $("LinkListPlace").innerHTML = "All Links";
  $("DisplayPlace").innerHTML = "";
  $("PlotPlace").innerHTML = "";
  KeyList = "";
  SegList = "";
  $("SSKeysPlace").innerHTML = "";
  $("SSPlace").innerHTML = "";
  $("RSCount_Place").innerHTML = "";
  RecordCount = 0;
  nkeysselected = 0;
  nsegsselected = 0;
  nlinksselected = 0;
  askedCount = 0;
  $("WantRecInfo").checked = 1;
  $("WantFullSegInfo").checked = 0;
  $("AllowBigQueries").checked = 0;
  $("RecSetPlace").innerHTML = "";
  $("MakeLocalFileLinks").checked = 0;
  CleanKeysSelect();
  }

function CleanKeysSelect()
  {
  KeyValsFetched = 0;
  for (var i=$("KeysSelect").length; i > 0; i--)
    $("KeysSelect").remove(i-1);
  for (var i=$("SegsSelect").length; i > 0; i--)
    $("SegsSelect").remove(i-1);
  for (var i=$("LinksSelect").length; i > 0; i--)
    $("LinksSelect").remove(i-1);
  for (var i=$("GraphKeysSelect").length; i > 0; i--)
    $("GraphKeysSelect").remove(i-1);
  $("DisplayPlace").innerHTML = "";
  $("PlotPlace").innerHTML = "";
  $("SegListPlace").innerHTML = "";
  $("LinkListPlace").innerHTML = "";
  $("KeyListPlace").innerHTML = "";
  KeyList =  "";
  SegList =  "";
  LinkList =  "";
  gridmade = 0;
  CleanOnLoad();
  }

function CleanOnLoad()
  {
  Host = location.host;
  definetabs();
  Element.hide('systemWorking');
  $("AbortGetSeriesButton").hide();
  $("AbortKeyValsButton").hide();
  $("FetchKeyValsButton").style.backgroundColor = "#FFFF80";
  $("SeriesButton").style.backgroundColor = "#FFFF80";
  // $("SeriesDiv").style.display="block";
  // $("FullInfoDiv").style.display="block";
  // $("FullInfoDivButton").style.backgroundColor = "FFD8D8";
  CreateTips();
  $("TipsOnOffButton").value = "Disable Help";
  $("TabsOnOffButton").value = "Disable Tabs";
  newwide();
  }

function CreateTips()
  {
  var tipstyle =
    {
    style:'protogrey',
    hook:{target:'topRight',tip:'bottomLeft'},
    stem:'bottomLeft',
    closeButton:false,
    hideAfter:5,
    hideOn:'click',
    showOn:'click',
    border:3,
    radius:3,
    };
  if (TipsCreated == 0)
    {
    // The following sample line goes in html code
       // <SPAN ID="SampleHelp" class="tip">?</SPAN>
    // the following line goes here
       // new Tip("SampleHelp","Help text here.",tipstyle);
    // XXXX HELP XXXX
    new Tip("PickSeriesHelp","This section is used to identify the JSOC data series you want to explore.  If you already know the series you may go to step 3 and enter the seriesname there.",tipstyle);
    new Tip("QueryBuilderHelp","This checkbox enables input boxes for recordset query clauses.  You may enter the desired recordset query in the text box below or with the QueryBuilder enabled just enter the seriesname in the main box and record selection clauses in the subsequent boxes.  There will be one box for each Prime-Key and one SQL where-clause box that keeps the Prime-Key version logic enabled '[?...?]', and one SQL where-clause box that will disable the Prime-Key version logic if the box is not empty '[!...!]'.  The punctuation is filled-in for you, i.e. the '[,?,!,]' as needed.",tipstyle);
    new Tip("RecordSetHelp","This text box is used to specify the Recordset you wish to examine or export.  You may start with just the seriesname to get a count of all the records in the series, then add filter clauses to limit the selected records to just the ones you want to examine or export.",tipstyle);
    }
  TipsCreated = 1;
  $$("span.tip").each(function(showspan){showspan.show();}); 
  }

function HideTips()
  {
  $$("span.tip").each(function(hidespan){hidespan.hide();}); 
  Tips.hideAll();
  }

function ToggleHelp()
  {
  if (TipsEnabled)
    {
    HideTips();
    $("TipsOnOffButton").value = "Enable Help";
    TipsEnabled = 0;
    }
  else
    {
    CreateTips();
    $("TipsOnOffButton").value = "Disable Help";
    TipsEnabled = 1;
    }
  }

 function QueryDivCheckToggle()
  {
  if ($("QueryDivCheck").checked == 0)
    {
    $("QueryDiv").style.display="none";
    }
  else
    {
    $("QueryDiv").style.display="block";
    }
  }

function insertOption(list,text,note)
  {
  var y=document.createElement('option');
  y.value=text;
  if (note.length)
    y.text = text + "  --- " + note;
  else
    y.text = text;
  var x = $(list);
  try
    {
    x.add(y,null); // standards compliant
    }
  catch(ex)
    {
    x.add(y); // IE only
    }
  }

var myGlobalHandlers = {
	onCreate: function()
	  {
          $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
          Element.show('systemWorking');
          },
	onComplete: function()
          {
          if(Ajax.activeRequestCount == 0)
            {
            $("AjaxBusy").innerHTML = "0";
	    Element.hide('systemWorking');
            }
          }
};

Ajax.Responders.register(myGlobalHandlers);

// Section 1.0 support, Get list of series and build select list for 2.0

function GetSeriesAbort()
  {
  if (GetSeriesObject == undefined)
    {
    return;
    }
  else if (GetSeriesObject.transport.readyState != 4)
    {
    GetSeriesObject.transport.abort();
    $("SeriesButton").style.backgroundColor = "#FFFF80";
    $("SeriesButton").value = "Fetch seriesname list";
    $("SeriesButton").disabled = false;
    $("AbortGetSeriesButton").hide();
    }
  }

function GetSeries()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  CleanSeriesInfo();
  $("SeriesButton").value = "Processing...";
  $("SeriesButton").style.backgroundColor = "#FFC8C8";
  $("SeriesButton").disabled = true;
  $("AbortGetSeriesButton").show();
  $("SeriesCountPlace").innerHTML = "<I>wait...</I>";
  GetSeriesObject = new Ajax.Request('http://' + Host + '/cgi-bin/ajax/show_series',
    {
    method: 'get',
    parameters: {"filter" : $("SeriesFilter").value },
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var SeriesList = response.evalJSON();
      CleanSeriesSelect();
      var n = SeriesList.n;
      for (var i = 0; i < n; i++)
        {
	insertOption("SeriesSelect",SeriesList.names[i].name,SeriesList.names[i].note);
        }
      $("SeriesCountPlace").innerHTML = SeriesList.n ;
      $("SeriesButton").style.backgroundColor = "#FFFF80";
      $("SeriesButton").value = "Fetch seriesname list";
      $("SeriesButton").disabled = false;
      $("AbortGetSeriesButton").hide();
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      },
    onFailure: function() { alert('Something went wrong...'); },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  }

// Section 2.0 support Select seriesfrom select list made in section 1.0
// Uses jsoc_info op=series_struct
// Get list of all keywords and segments with supporting info
// Fetches full list of keywords and segments for display in section 4 and
// build select lists used in section 4 and 5.
// If mode==0 then use the SeriesSelect box for the chosen series.
// else if mode==1 then use the SeriesName variable as is and fetch
// info and reset all associated references.
// If mode==2 then the section 3 series name becomes the new SeriesName
// and info for it will be found and displayed.

function PickSeries(mode)
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  CleanSeriesPick();
  if (mode == 0)
    {
    CurrentSeries = $("SeriesSelect").selectedIndex;
    SeriesName = $("SeriesSelect").options[CurrentSeries].value;
    }
  if (mode != 2)
    {
    $("RecordSet").value = SeriesName;
    $("QueryPlace").innerHTML = "";
    }
  $("Series_Name_Place").innerHTML = SeriesName;
  $("RecSetPlace").innerHTML = SeriesName;
  $("FirstLastPlace").innerHTML = "... Fetching Series Information ...";
  new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info_test',
    {
    method: 'get',
    parameters: {"ds" : SeriesName, "op" : "series_struct" },

    onSuccess: function(transport, json)
      {
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      var response = transport.responseText || "no response text";
      var SeriesInfo = response.evalJSON();
      if (SeriesInfo.status == 1)
        {
        $("FirstLastPlace").innerHTML = "No Matching Series Found";
        $("SSPlace").innerHTML = "No Series Struct Found";
        $("SSKeysPlace").innerHTML = "";
        CleanKeysSelect();
        }
      else
        {
        var i;
        // Get series descriptive note and display
        $("Series_Info_Place").innerHTML = "Series Description: " + SeriesInfo.note;

        // Get list of prime keys and index keys and display info
        // Get prime key special info from primekeys array, but
        // get prime keyword type and units, defaults, from matching keywords array element
        var QueryBoxes = "<TABLE>";
	nprimes = SeriesInfo.primekeysinfo.length;
	var primes = "No PrimeKeys";
        if (nprimes == 1 && SeriesInfo.primekeysinfo[0] == null)
          nprimes = 0;
	if (nprimes > 0)
	  for (i=0; i<nprimes; i++)
            {
            if (i==0)
	        primes = SeriesInfo.primekeysinfo[0].name;
            else
	        primes = primes + ", " + SeriesInfo.primekeysinfo[i].name;
            var k;
            for (k=0; k<SeriesInfo.keywords.length; k++)
               if (SeriesInfo.keywords[k].name === SeriesInfo.primekeysinfo[i].name)
                  break;
            var isslotted = SeriesInfo.primekeysinfo[i].slotted;
            QueryBoxes = QueryBoxes + 
                "<TR><TD>" + SeriesInfo.primekeysinfo[i].name + "</TD>" + 
                "<TD align='right'>" + "[&nbsp;&nbsp;<input id='Prime" + i +
                "' type='text' value='' onChange='QueryBuild();' >&nbsp;&nbsp;]</TD>" +
                "<TD> (" + SeriesInfo.keywords[k].type + (isslotted ? "-slotted, " + SeriesInfo.primekeysinfo[i].step : "") + ")</TD>";
            if (SeriesInfo.keywords[k].type === "time")
                QueryBoxes = QueryBoxes + "<TD> expects " + SeriesInfo.keywords[k].units + "</TD>";
            else
                QueryBoxes = QueryBoxes + "<TD></TD>";

            QueryBoxes = QueryBoxes +  "</TR>";
            }
        QueryBoxes = QueryBoxes +  "<TR><TD>where clause</TD>" + 
            "<TD align='right'>" + "[?&nbsp;<input id='WhereClause0' type='text' value='' onChange='QueryBuild();' >&nbsp;?]</TD>" +
            "<TD colspan=2>Uses prime key logic</TD></TR>";
        QueryBoxes = QueryBoxes +  "<TR><TD>where clause</TD>" + 
            "<TD align='right'>" + "[!&nbsp;<input id='WhereClause1' type='text' value='' onChange='QueryBuild();' >&nbsp;!]</TD>" +
            "<TD colspan=2> use disables prime key logic</TD></TR>";
        QueryBoxes = QueryBoxes + "</TABLE>";
        $("QueryPlace").innerHTML = QueryBoxes;
        if ($("QueryDivCheck").checked == 1)
            {
	    $("QueryDiv").style.display="block";
            }
        else
            {
	    $("QueryDiv").style.display="none";
            }
	var n = SeriesInfo.dbindex.length;
	var dbindex = "No DBindex";
	if (n > 0) dbindex = SeriesInfo.dbindex[0];
	for (i=1; i<n; i++)
	    dbindex = dbindex + ", " + SeriesInfo.dbindex[i];
        $("SSKeysPlace").innerHTML = "PrimeKeys: " + primes + "<BR>" +
                                     "DBindex: " + dbindex + "<BR>";
        // Add segment information if present
        if (SeriesInfo.segments.length > 0)
	  {
          if (SeriesInfo.archive > 0)
            $("SSKeysPlace").innerHTML = $("SSKeysPlace").innerHTML +
		"Data is archived, online retention " + SeriesInfo.retention + " days<BR>";
	  else
            $("SSKeysPlace").innerHTML = $("SSKeysPlace").innerHTML +
		"Data NOT archived, online retention " + SeriesInfo.retention + " days<BR>";
          $("SSKeysPlace").innerHTML = $("SSKeysPlace").innerHTML + "Unitsize: " + SeriesInfo.unitsize + " record" +
	    (SeriesInfo.unitsize > 1 ? "s" : "") + "<P>";
	  }
	else
          $("SSKeysPlace").innerHTML = $("SSKeysPlace").innerHTML + "No SUMS storage for this series<P>";

        // build and display keyword selection scroll box and keyword part of full table
	var keywords = "No keywords";
	n = SeriesInfo.keywords.length;
	if (n > 0)
	   {
	   insertOption("KeysSelect","**NONE**", "");
	   insertOption("KeysSelect","**ALL**", "");
	   for (i=0; i<n; i++)
	      insertOption("KeysSelect",SeriesInfo.keywords[i].name, "");
	   keywords = keywords + "</table><P>";
	   insertOption("KeysSelect","*recdir*", "");
	   insertOption("KeysSelect","*dirmtime*", "");
	   insertOption("KeysSelect","*logdir*", "");
	   insertOption("KeysSelect","*recnum*", "");
	   insertOption("KeysSelect","*sunum*", "");
	   insertOption("KeysSelect","*size*", "");
	   insertOption("KeysSelect","*online*", "");
	   insertOption("KeysSelect","*retain*", "");
	   insertOption("KeysSelect","*archive*", "");

	   keywords = "<table BORDER=1><TR><TH>keyword</TH><TH>type</TH><TH>scope</TH><TH>default</TH><TH>unit</TH><TH>note</TH>"; 
           for (i=0; i<n; i++)
              {
              keywords = keywords + "<TR><TD>" + 
		SeriesInfo.keywords[i].name + "</TD><TD>" +
		SeriesInfo.keywords[i].type + "</TD><TD>" +
		SeriesInfo.keywords[i].recscope + "</TD><TD>" +
		SeriesInfo.keywords[i].defval + "&nbsp;</TD><TD>" +
		SeriesInfo.keywords[i].units + "&nbsp;</TD><TD>" +
		SeriesInfo.keywords[i].note + "&nbsp;</TD></TR>";
	      }
	   }

        // build and display segment selection scroll box and segment part of full table
	var segments = "No segments";
	n = SeriesInfo.segments.length;
	if (n > 0)
	   {
	   segments = "<table BORDER=1><TR><TD>segment</TD><TD>units</TD><TD>dims</TD><TD>protocol</TD><TD>note</TD>";
	   insertOption("SegsSelect","**NONE**", "");
	   insertOption("SegsSelect","**ALL**", "");
	   for (i=0; i<n; i++)
	      {
	      insertOption("SegsSelect",SeriesInfo.segments[i].name, "");
	      segments = segments + "<TR><TD>" + SeriesInfo.segments[i].name + "</TD><TD>" + SeriesInfo.segments[i].units + "&nbsp;</TD><TD>" +
		SeriesInfo.segments[i].dims + "&nbsp;</TD><TD>" + SeriesInfo.segments[i].protocol + "</TD><TD>" + SeriesInfo.segments[i].note + "&nbsp;</TD></TR>";
	      }
	   segments = segments + "</table><P>";
	   }

        // build and display link selection scroll box and segment part of full table
	var links = "No links";
	n = SeriesInfo.links.length;
	if (n > 0)
	   {
	   links = "<table BORDER=1><TR><TD>link</TD><TD>target </TD><TD>kind</TD><TD>note</TD>";
	   insertOption("LinksSelect","**NONE**", "");
	   insertOption("LinksSelect","**ALL**", "");
	   for (i=0; i<n; i++)
	      {
	      links = links + "<TR><TD>" + SeriesInfo.links[i].name + "</TD><TD>" + SeriesInfo.links[i].target + "</TD><TD>" +
		      SeriesInfo.links[i].kind + "</TD><TD>" + SeriesInfo.links[i].note + "&nbsp;</TD></TR>";
	      insertOption("LinksSelect",SeriesInfo.links[i].name, "");
              }
	   links = links + "</table><P>";
	   }

	// Place structure table on screen
        $("SSPlace").innerHTML =  keywords + "<BR>" + segments + "<BR>" + links;

	// Place first and last record info on screen
	if (SeriesInfo.Interval.MaxRecnum > 0)
          $("FirstLastPlace").innerHTML = "First Record = " + SeriesInfo.Interval.FirstRecord + 
              "<BR>Last Record = " + SeriesInfo.Interval.LastRecord +
	      "<BR>First Rec., Last Rec. and largest used recnums: " + SeriesInfo.Interval.FirstRecnum + ", " +
              SeriesInfo.Interval.LastRecnum + ", " +  SeriesInfo.Interval.MaxRecnum + " resp." ;
	else
	  $("FirstLastPlace").innerHTML = "This series contains no records";
        // Done displaying detailed information for this series
        }
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      },
    onFailure: function() { alert('Something went wrong with series structure request'); },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  // Now jump to the RecordSet tab
  tabs.setSelectedItems([tabrecset]); // load the first page.
  }

// Section 3.0 support - Get record count
// Uses jsoc_info op=rs_summary which may take a while but
// also validates recordset query that will be used in section 6.

function SetRSLimit()
  {
  if ($("RecordLimit").value === "none")
    MaxRecs = 0;
  else if (Number($("RecordLimit").value)) 
    MaxRecs = Number($("RecordLimit").value);
  else
    {
    $("RecordLimit").value = "none";
    MaxRecs = 0;
    }
  GetRSCount();
  }

function GetRSCount()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
// concatenate parts here, display in fixed string
  var posbracket = $("RecordSet").value.indexOf("[");
  var posRbracket = $("RecordSet").value.indexOf("]");
  var thisSeriesName;
  if (posbracket == -1)
    {
    thisSeriesName = $("RecordSet").value;
    }
  else
    {
    if (posRbracket == -1)
      {
      $("RSCount_Place").innerHTML = "ERROR - missing right bracket - ]";
      return;
      }
    thisSeriesName = $("RecordSet").value.substr(0,posbracket);
    }
  if (thisSeriesName != SeriesName)
    {
    $("RSCount_Place").innerHTML = "Getting series information - wait...";
    SeriesName = thisSeriesName;
    PickSeries(2);
    }
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  $("RSCount_Place").innerHTML = "Getting count - wait...";
  RecordCount = -1;
  askedCount = 1;
  new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info_test',
    {
    method: 'get',
    parameters: {"ds" : $("RecordSet").value, "op" : "rs_summary", "n" : MaxRecs },

    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var SummaryData = response.evalJSON();
      if (SummaryData.status != 0)
        {
	RecordCount = 0;
        $("RSCount_Place").innerHTML = "No RecordSet Count Found";
        }
      else
	{ 
	RecordCount = SummaryData.count;
	$("RSCount_Place").innerHTML = SummaryData.count;
	}
      $("ExportRecordSet").innerHTML = $("RecordSet").value;
      if (nsegsselected > 0)
        $("ExportRecordSet").innerHTML = $("ExportRecordSet").innerHTML + "{" + SegList + "}";
      $("RecSetPlace").innerHTML = $("RecordSet").value;
      if (KeyValsFetched == 1)
        {
        $("FetchKeyValsButton").value = "Update Keyword Values for RecordSet";
        $("FetchKeyValsButton").style.backgroundColor = "#FFD8D8";
        }
      },
    onFailure: function() { alert('Something went wrong with series summary request'); },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  }

// QueryBuild is called when where clause specs are added to build a recordset spec
function QueryBuild()
  { 
  var QueryString = SeriesName;
  for (var i=0; i<nprimes; i++)
    {
    QueryString = QueryString + "[" + $("Prime"+i).value + "]";
    }
  if ($("WhereClause0").value.length > 0)
    QueryString = QueryString + "[? " + $("WhereClause0").value + " ?]";
  if ($("WhereClause1").value.length > 0)
    QueryString = QueryString + "[! " + $("WhereClause1").value + " !]";
  $("RecordSet").value = QueryString;
  }

// Section 4, Select keys for fetching values
// Uses select list of keyword names made in section 4.
// Places result in list to be used in section 6.

function PickKeys()
  {
  var ikey = 0;
  nkeysselected = 0;
  var nkeys = $("KeysSelect").length;
  var selkeys =  "";
  $("KeyListPlace").innerHTML = "";
  $("DisplayPlace").innerHTML = "";
  $("PlotPlace").innerHTML = "";
  for (var i=$("GraphKeysSelect").length; i > 0; i--)
    $("GraphKeysSelect").remove(i-1);
  // $("WantRecInfo").checked = 0;
  KeyList =  "";
  selkeys = "";
  // check for **NONE**
  if ($("KeysSelect")[0].selected)
    {
    nkeysselected = 0;
    selkeys = "**NONE**";
    KeyList = "**NONE**";
    }
  // check for **ALL**
  // else if ($("KeysSelect")[1].selected)
    // {
    // nkeysselected = nkeys - 2;
    // selkeys = "**ALL**";
    // KeyList = "**ALL**";
    // }
  else
   for (ikey=0; ikey < nkeys; ikey++)
    if ($("KeysSelect")[ikey].selected)
      {
      if (nkeysselected)
	{
	selkeys = selkeys + ", ";
        KeyList = KeyList + ",";
	}
      nkeysselected = nkeysselected + 1;
      selkeys = selkeys + $("KeysSelect")[ikey].text;
      KeyList = KeyList + $("KeysSelect")[ikey].text;
      if (ikey > 0)
        insertOption("GraphKeysSelect",$("KeysSelect")[ikey].text, ikey);
      }
  $("KeyListPlace").innerHTML = nkeysselected + " Keys Chosen:&nbsp;" + selkeys;
  }

// Graph making code
//
// code to get the list of keywords to be graphed
// this should be called only after the data is fetched for ValueTable
//
  // <form id="GraphSelectForm">
  // <select id="GraphKeysSelect" size=8 multiple="multiple" onChange="GraphPickKeys();" > </select>

function GraphPickKeys()
  {
  var igraphkey = 0;
  var ngraphkeys = $("GraphKeysSelect").length;
  var ikey = 0;
  var nkeys = RecordData.keywords.length;
  var graphKeysSelected = 0;
  for (igraphkey=0; ikey < ngraphkeys; igraphkey++)
    if ($("GraphKeysSelect")[igraphkey].selected)
      {
      // get column number and name for graph
      for (ikey=0; ikey < nkeys; ikey++)
        {
        if ($("GraphKeysSelect")[igraphkey].text == RecordData.keywords[ikey].name)
          { alert ("got graph key for col="+ikey+" name=" + RecordData.keywords[ikey].name);
          graphAddCol(RecordData.keywords[ikey].name, ikey);
          }
        }
      }
  }

// Section 5., Select segments for fetching pathnames
// Uses select list of segment names made in section 4.
// Places result in list to be used in section 6.

function PickSegs()
  {
  var iseg = 0;
  nsegsselected = 0;
  var nsegs = $("SegsSelect").length;
  var selsegs =  "";
  $("SegListPlace").innerHTML = "";
  $("DisplayPlace").innerHTML = "";
  // $("WantRecInfo").checked = 0;
  SegList =  "";
  selsegs = "";
  // check for **NONE**
  if ($("SegsSelect")[0].selected)
    {
    nsegsselected = 0;
    selsegs = "**NONE**";
    SegList = "**NONE**";
    }
  // check for **ALL**
  else if ($("SegsSelect")[1].selected)
    {
    nsegsselected = nsegs - 2;
    selsegs = "**ALL**";
    SegList = "**ALL**";
    }
  else
   for (iseg=0; iseg < nsegs; iseg++)
    if ($("SegsSelect")[iseg].selected)
      {
      if (nsegsselected)
	{
	selsegs = selsegs + ", ";
        SegList = SegList + ",";
	}
      nsegsselected = nsegsselected + 1;
      selsegs = selsegs +  $("SegsSelect")[iseg].text;
      SegList = SegList +  $("SegsSelect")[iseg].text;
      }
  $("SegListPlace").innerHTML = nsegsselected + " Segs Chosen:&nbsp;" + selsegs;
  }

// Section 5++., Select links for fetching pathnames
// Uses select list of link names made in section 5.5.
// Places result in list to be used in section 6.

function PickLinks()
  {
  var ilink = 0;
  nlinksselected = 0;
  var nlinks = $("LinksSelect").length;
  var sellinks =  "";
  $("LinkListPlace").innerHTML = "";
  $("DisplayPlace").innerHTML = ""; 
  // $("WantRecInfo").checked = 0;
  LinkList =  "";
  sellinks = "";
  // check for **NONE**
  if ($("LinksSelect")[0].selected)
    {
    nlinksselected = 0;
    sellinks = "**NONE**";
    LinkList = "**NONE**";
    }
  // check for **ALL**
  else if ($("LinksSelect")[1].selected)
    {
    nlinksselected = nlinks - 2;
    sellinks = "**ALL**";
    LinkList = "**ALL**";
    }
  else
   for (ilink=0; ilink < nlinks; ilink++)
    if ($("LinksSelect")[ilink].selected)
      {
      if (nlinksselected)
	{
	sellinks = sellinks + ", ";
        LinkList = LinkList + ",";
	}
      nlinksselected = nlinksselected + 1;
      sellinks = sellinks +  $("LinksSelect")[ilink].text;
      LinkList = LinkList +  $("LinksSelect")[ilink].text;
      }
  $("LinkListPlace").innerHTML = nlinksselected + " Links Chosen:&nbsp;" + sellinks;
  }

// Section 6.0 - Get record values for selected keywords and segments
// Uses jsoc_info op=rs_list
// Places result in table.

function AbortGetKeyValues()
  {
  if (GetValuesObject == undefined)
    {
    return;
    }
  else if (GetValuesObject.transport.readyState != 4)
    {
    GetValuesObject.transport.abort();
    $("FetchKeyValsButton").value = "Fetch Keyword Values for RecordSet";
    $("FetchKeyValsButton").style.backgroundColor = "#FFFF80";
    $("FetchKeyValsButton").disabled = false;
    $("AbortKeyValsButton").hide();
    $("DisplayPlace").innerHTML = "Request aborted";
    }
  }

var griddata;
var gridcolwidth;

function setgriddata(i,val)
  {
  var thisval = (val != null && val.length > 0 ? val : "&nbsp");
  griddata[i] = thisval;
  gridcolwidth[i] = Math.max(gridcolwidth[i], thisval.length);
  i++;
  return i;
  }

var RecordData;

function GetKeyValues()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  var getparameters = new Hash( {"ds" : $("RecordSet").value, "op" : "rs_list" });
  $("DisplayPlace").innerHTML = "Requesting Recordset Key Values ...";
  if (nkeysselected < 1 && nsegsselected < 1 && nlinksselected < 1 && $("WantRecInfo").checked == 0)
    {
    $("DisplayPlace").innerHTML = "No keywords and NO segments requested.<BR>Please fo back to steps 4 and 5."; 
    return;
    }
  if (MaxRecs != 0)
    getparameters = getparameters.merge({"n": MaxRecs});
  if (nkeysselected)
    getparameters = getparameters.merge({"key": KeyList});
  else
    getparameters = getparameters.merge({"key":"**NONE**"});
  if (nsegsselected)
    getparameters = getparameters.merge({"seg": SegList});
  else
    getparameters = getparameters.merge({"seg":"**NONE**"});
  if (nlinksselected)
    getparameters = getparameters.merge({"link": LinkList});
  else
    getparameters = getparameters.merge({"link":"**NONE**"});
  if ($("WantRecInfo").checked) getparameters = getparameters.merge({"R":1});
  if (RecordCount == 0 && askedCount == 0)
      GetRSCount();
  if (RecordCount < 0)
    {
      $("DisplayPlace").innerHTML = "RecordSet count underway (step 3), please wait for it to complete before retrying";
      return;
    }
  if (RecordCount == 0)
    {
    $("DisplayPlace").innerHTML = "There are no records in the chosen RecordSet";
    return;
    }
  if (RecordCount > 10000 && !$("AllowBigQueries").checked)
    {
    $("DisplayPlace").innerHTML = "Requested Recordset is too large for this function, " + RecordCount + 
	" records.<BR>Please go back to step 3 and choose a smaller recordset.";
    return;
    }
  $("FetchKeyValsButton").value = "Processing ...";
  $("FetchKeyValsButton").style.backgroundColor = "#FFD8D8";
  $("FetchKeyValsButton").disabled = true;
  $("AbortKeyValsButton").show();
  GetValuesObject = new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info_test',
    {
    method: 'get',
    parameters: getparameters.toObject(),

    onSuccess: function(transport, json)
      {
      $("DisplayPlace").innerHTML = "Data received, processing ...";
      var response = transport.responseText || "no response text";
      RecordData = response.evalJSON();
      // var RecordData = JSON.parse(response);
      if (RecordData.status == 1)
        {
        $("DisplayPlace").innerHTML = RecordData.error;
	AbortGetKeyValues();
        }
      else
        {
         //  valuegrid = new AW.UI.Grid; 
        valuegrid = new AW.Grid.Extended; 
        valuegrid.setId("ValueGrid");

        $("FetchKeyValsButton").value = "Fetch Keyword Values for RecordSet";
        $("FetchKeyValsButton").style.backgroundColor = "#FFFF80";
        $("FetchKeyValsButton").disabled = false;
        $("AbortKeyValsButton").hide();
        KeyValsFetched = 1;
	wantLocalLinks = $("MakeLocalFileLinks").checked;
	var thissegdata = "";
	var nkeys = RecordData.keywords.length;
	var nsegs = RecordData.segments.length;
	var nlinks = RecordData.links.length;
	var nrecs = RecordData.count;
        var gridcols = nkeys + 2*nsegs + nlinks;
        var segcols = new Array(nsegs);
        wantrecinfo = $("WantRecInfo").checked;
	if (wantrecinfo) gridcols += 1;
	if ($("WantFullSegInfo").checked == 1) gridcols += 3*nsegs;
        var gridrows = nrecs;
        var irow, icol;

        $("DisplayPlace").innerHTML = "Status = " + RecordData.status + ", Recordset Key Values for " + nrecs + " records returned, preparing page ...";

        var gridcells = new Array(gridrows);

        // Build header row
        var gridhead = new Array(gridcols);
        var ihead = 0
	if (wantrecinfo)
           gridhead[ihead++] = "RecordName";
	for (var ikey=0; ikey < nkeys; ++ikey)
           gridhead[ihead++] = RecordData.keywords[ikey].name;
	for (var iseg=0; iseg < nsegs; ++iseg)
           {
           segcols[iseg] = ihead;
           gridhead[ihead++] = RecordData.segments[iseg].name;
           gridhead[ihead++] = "seg_dims: " + RecordData.segments[iseg].name;
	   if ($("WantFullSegInfo").checked == 1)
	       {
               gridhead[ihead++] = "seg_cparms: " + RecordData.segments[iseg].name;
               gridhead[ihead++] = "seg_bzero: " + RecordData.segments[iseg].name;
               gridhead[ihead++] = "seg_bscale: " + RecordData.segments[iseg].name;
               }
            }
	  for (var ilink=0; ilink < nlinks; ++ilink)
            gridhead[ihead++] = "Link: " + RecordData.links[ilink].name;
        gridcolwidth = new Array(gridcols);

        for (icol=0; icol<gridcols; icol++)
	  gridcolwidth[icol] = gridhead[icol].length;

          // build data rows
	  for (var irec=0; irec < nrecs; irec++)
	     {
             griddata = new Array(gridcols);
             var idata = 0;
	     if (wantrecinfo)
		idata = setgriddata(idata, RecordData.recinfo[irec].name);
	     for (ikey=0; ikey<nkeys; ikey++)
	       {
	       var this_keyval =  RecordData.keywords[ikey].values[irec] + "";
               if (this_keyval.length == 0) this_keyval = " ";
	       idata = setgriddata(idata, this_keyval);
	       }
	     for (iseg=0; iseg<nsegs; iseg++)
	        {
	        thissegdata = RecordData.segments[iseg].values[irec];
		griddata[idata] = thissegdata;
		gridcolwidth[idata] = Math.max(gridcolwidth[idata], RecordData.segments[iseg].values[irec].length);
                idata++;
	        idata = setgriddata(idata, RecordData.segments[iseg].dims[irec]);
	        if ($("WantFullSegInfo").checked == 1)
	           {
	           idata = setgriddata(idata, RecordData.segments[iseg].cparms[irec]);
	           idata = setgriddata(idata, RecordData.segments[iseg].bzeros[irec]);
	           idata = setgriddata(idata, RecordData.segments[iseg].bscales[irec]);
	           }
	        }
	     for (ilink=0; ilink<nlinks; ilink++)
	        idata = setgriddata(idata, RecordData.links[ilink].values[irec]);
	     gridcells[irec] = griddata;
	     valuegrid.addRow(irec);
	     }

	// valuegridlabel = new AW.UI.Label;
	// valuegridlabel.setId("myLabel");
	// valuegridlabel.refresh();

        valuegrid.setSelectionMode("single-cell"); // set selection mode to single row
        valuegrid.setColumnCount(gridcols);
        valuegrid.setFixedLeft(1);	// number of fixed columns on the left side
        valuegrid.setRowCount(gridrows);
        valuegrid.setHeaderText(gridhead);
        valuegrid.setCellData(gridcells);
        valuegrid.setVirtualMode(true);
// valuegrid.getCellTemplate().setStyle('border-style','thin');
valuegrid.getCellTemplate().setStyle('border-left-style','dotted');
valuegrid.getCellTemplate().setStyle('border-left-width','1');
	// valuegrid.setSelectorVisible(true);
	// valuegrid.setSelectorWidth(28);
	// valuegrid.setSelectorText(function(i){return this.getRowPosition(i)+1});
        
        // fix data links
        icol = 0;
	if (wantrecinfo)
           icol=1;
	for (ikey=0; ikey<nkeys; ikey++)
	   {
	   if (RecordData.keywords[ikey].name == "*logdir*")
	    for (var irec=0; irec < nrecs; irec++)
	      {
	      var this_keyval =  RecordData.keywords[ikey].values[irec];
              valuegrid.setCellText(this_keyval, icol+ikey, irec);
              valuegrid.setCellLink("http://jsoc.stanford.edu" + this_keyval, icol+ikey, irec);
              valuegrid.setCellTemplate(new AW.Templates.Link, icol+ikey, irec);
	      valuegrid.getCellTemplate(icol, irec).setAttribute("target","_blank");
              }
	   }
	for (iseg=0; iseg<nsegs; iseg++)
	  {
          icol = segcols[iseg];
	  for (var irec=0; irec < nrecs; irec++)
            {
	    thissegdata = RecordData.segments[iseg].values[irec];
            if (RecordData.recinfo[irec].online)
	       {
               valuegrid.setCellText(thissegdata, icol, irec);
	       if (wantLocalLinks)
                 valuegrid.setCellLink("file://" + thissegdata, icol, irec);
               else
                 valuegrid.setCellLink("http://jsoc.stanford.edu" + thissegdata, icol, irec);
               valuegrid.setCellTemplate(new AW.Templates.Link, icol, irec);
	       valuegrid.getCellTemplate(icol, irec).setAttribute("target","_blank");
	       }
            }
	  }
        for (icol=0; icol<gridcols; icol++)
           {
	   valuegrid.setColumnWidth(Math.round(8.5*gridcolwidth[icol]), icol);
           }
	valuegrid.refresh();

        $("DisplayPlace").innerHTML = valuegrid;
	gridmade = 1;
        newwide();
        tabs.setSelectedItems([tabdisplay]); // show the display page.
        }
      },
    onFailure: function() { alert('Something went wrong with series data request'); },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  }

function newwide(thisevent)
  {
  if (gridmade)
        {
	CWidth = self.innerWidth;
	CHeight = self.innerHeight;
        valuegrid.setSize(CWidth - 35 ,CHeight - 310);
        $("DisplayPlace").innerHTML = valuegrid;
        }
  $("SeriesInfoDiv").style.height = (1*CHeight - 200);
  return true;
  }


function amChartInited(chart_id)
  {
  flashMovie = document.getElementById(chart_id);
  $("amChartDiv").style.display="block";
  amChartOK = 1;
  }
  
var graphcols = new Array();

function graphAddCol(name, column)
  {
  var ncols = graphcols.length;
  var colinfo = new Object();
  colinfo["col"] = column;
  colinfo["name"] = name;
  graphcols[ncols] = colinfo;
  }

function GraphDelete()
  {
  graphcols = new Array();
  for (igraphkey=0; ikey < ngraphkeys; igraphkey++)
    $("GraphKeysSelect")[igraphkey].selected = 0;
  GraphCreate();
  }

function GraphCreate()
  {

  var gcols = graphcols.length;
  var datecol = $("DateColumn").value;
  var ncols = RecordData.keywords.length;
  var n=RecordData.count;
  var csvdata = "";
  for (i=0; i<n; i++)
    {
    var line = "";
    var val, x, y;
    if (datecol == -1)
      x = i;
    else
      x = RecordData.keywords[datecol].values[i];
    line = line + x;
    for (icol=0; icol<gcols; icol++)
      {
      var pcol = graphcols[icol].col;
      val = RecordData.keywords[pcol].values[i];
      if (val === "MISSING")
        y = 0.0;
      else
        y = val;
      line = line + "," + y;
      }
    csvdata = csvdata + line + '\n';
    }
// alert("data ready" + csvdata);
  <!-- amline script-->
  var so = new SWFObject("js/amCharts/amline.swf", "jsocgraph", "900", "400", "8", "#FFFFFF");
  so.addVariable("chart_id", "jsocgraph");
  so.addVariable("path", "js/amCharts/");
  so.addVariable("settings_file", encodeURIComponent("js/amCharts/jsocline_settings.xml"));
  so.addVariable("preloader_color", "#999999");
  var labl = "<settings><graphs>" ;
  for (icol=0; icol<gcols; icol++)
      {
      var pcol = icol+1;
      labl = labl + '<graph gid="'+pcol+'"><title>"'+graphcols[icol].name+'"</title><line_width>1</line_width>' +
		 '<selected>0</selected></graph>' ;
      }
  labl = labl + "</graphs></settings>";
  so.addVariable("additional_chart_settings", encodeURIComponent(labl));
  so.addVariable("chart_data", encodeURIComponent(csvdata));
  //  so.setData(csvdata);
  so.write("flashcontent");
so.rebuild();
  <!-- end of amline script -->
  }

function Export_Recordset()
  {
  Cookie.init({name:"exportdata"});
  Cookie.setData("state",0);
  if (nsegsselected > 0 && $("ExportRecordSet").innerHTML.indexOf("}") == -1)
    $("ExportRecordSet").innerHTML = $("ExportRecordSet").innerHTML + "{" + SegList + "}";
  ExportWindow=window.open("http://" + Host + "/ajax/exportdata.html?ds="+$("ExportRecordSet").innerHTML,
             "JSOC_Export");
  ExportWindow.window.focus();
  }

</script>

</HEAD>

<BODY BGCOLOR="#E0F0FF" onLoad="CleanOnLoad();" onresize="newwide(event);" > 

<DIV ID="header">
  <IMG src="http://hmi.stanford.edu/images/web/JSOC_120.gif"
    style="vertical-align:middle;height:60px" alt="JSOC logo">
  &nbsp;&nbsp;&nbsp;
  <B><big style="vertical-align:middle">&nbsp;&nbsp;JSOC Data Explore Info and Export</big></B>
  &nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;
  <input type="button" value="Reset Page" onClick="InitPage();" >
  &nbsp;&nbsp;
  <input id="TabsOnOffButton" type="button" value="Disable Tabs" onClick="ToggleTabs();" >
  &nbsp;&nbsp;
  <input id="TipsOnOffButton" type="button" value="Disable Help" onClick="ToggleHelp();" >
  &nbsp;&nbsp;<span id="AjaxBusy">0</span> Requests Pending
  <span id='systemWorking'>, Loading...</span>
  <!-- <HR> -->
  <P>
</DIV> <!-- end DIV header -->
<SPAN id="LookdataTabs"></SPAN>
<DIV id="JsocLookdata" style="border: 1px solid #aaa;">
<DIV id="TabSeriesSelectDiv" style="display:block">
  <DIV id="SeriesDiv">
    <TABLE style="width:98%">
    <TR> <TD  style="width:50%;vertical-align:top;"></TD><TD style="width:50%;vertical-align:top;"></TD></TR>
    <TR> <TD colspan==2>
    <SPAN ID="PickSeriesHelp" class="tip">?</SPAN>
    You may go directly to Step 3 on the RecordSet Select tab if you know which series you want.
    </TD></TR>
    <TR> <TD><B>1. Find list of dataseries</B></TD><TD><B>2. Pick series to use</B></TD></TR>
    <TR>
    <TD>
    Enter a dataseries match pattern to search for seriesnames, or leave blank to select from all series.
    (A very bad idea now that we have about 34,000 seriesnames.)
    A leading "NOT " means exclude names matching the subsequent pattern.
    The default filter excludes namespace "dsds."
    <P>
    <input id="SeriesFilter" type="text" name="filter" value="NOT ^dsds\." onChange="GetSeries();" >
    <BR>
    <input id="SeriesButton" type="button" value="Fetch seriesname list" style="background-color:#FFFF80" onClick="GetSeries();" > 
    <input id="AbortGetSeriesButton" type="button" value="Abort" style="background-color:#FFD0D0" onClick="GetSeriesAbort();" > 
    <br>
    <span id="SeriesCountPlace" style="background-color:#FFFFFF;width:2em"><I>TBD</I></span>
    Series match this selection filter.
    </TD>
    <TD>
    Select data series here.
    <BR>
    <select id="SeriesSelect" size=8 onclick="PickSeries(0)"> </select>
    </TD>
    </TR>
    </TABLE>
  </DIV> <!-- /DIV SeriesDiv -->
</DIV> <!-- /DIV TabSeriesSelectDiv -->
<DIV id="TabRecSetDiv" style="display:block">
  <DIV id="MySeriesDiv" >
    <TABLE style="width:98%">
      <TR><TD style="width:33%"></TD><TD style="width:33%;"></TD><TD style="width:33%;"></TD></TR>
      <TR>
        <TD rowspan=2 style="vertical-align:top;height:60px">
        <B>Information about selected series</B><BR>
        Current Series is:
        <span id="Series_Name_Place" style="background-color:#FFFFFF"></span>
        <BR>
        <span id="SSKeysPlace" style="background-color:#FFFFFF;"></span>
        </TD>
        <TD colspan=2 style="vertical-align:top">
        &nbsp;<BR>
        <span id="Series_Info_Place" style="background-color:#FFFFFF"></span>
        </TD>
      </TR>
      <TR>
        <TD colspan=2>
        <span id="FirstLastPlace" style="vertical-align:top;background-color:#FFFFFF"></span>
        </TD>
      </TR>
      <TR>
        <TD colspan=2  style="vertical-align:top;">
        <B>3. Select Records and Get Record Count</B><BR>
        Enter RecordSet Specification here for keyword listings and for export.
        <BR>
        <SPAN ID="QueryBuilderHelp" class="tip">?</SPAN>
        <input type="checkbox" name="" id="QueryDivCheck" onChange="QueryDivCheckToggle();">
        Check box  to show the QueryBuilder.
        <BR>
        Request may take a while if the recordset is large (more than a few thousand records).
        <P>
        <SPAN ID="RecordSetHelp" class="tip">?</SPAN>
        <input id="RecordSet" type="text" value="" onChange="GetRSCount();" > 
        <BR>
        <DIV id="QueryDiv">
          <span id="QueryPlace" style="width:10em;background-color:#FFFFFF;"></SPAN></span>
        </DIV>
        <P>
        &nbsp;&nbsp;
        Record Limit &nbsp;
        <input type="text" value="none" name="" id="RecordLimit" onChange="SetRSLimit();" >
        &nbsp;  Optional, + for from start, - for from end.
        <P>
        <input type="button" value="GetRecordCount"  style="background-color:#FFFF80" onClick="GetRSCount();" >
        Record Count:&nbsp;&nbsp;
        <span id="RSCount_Place" style="width:10em;background-color:#FFFFFF"></span>
        <P>
        <input type="checkbox" name="Get Record Query" id="WantRecInfo"> Check to Get Record Query.  <BR>
        <input type="checkbox" name="AllowBigQueries" id="AllowBigQueries"> Check to Allow Huge Record Queries.  <BR>
        <input type="checkbox" name="WantFullSegInfo" id="WantFullSegInfo"> Check to show full segment info <BR>
        <input type="checkbox" name="MakeLocalFileLinks" id="MakeLocalFileLinks"> Check to make local file links (only at JSOC).  <BR>
        <input type="button" id="FetchKeyValsButton" value="Fetch Keyword Values for RecordSet" style="background-color:#FFFF80" onClick="GetKeyValues();" >
        <input type="button" id="AbortKeyValsButton" value="Abort" style="background-color:#FFD0D0" onClick="AbortGetKeyValues();" >
        </TD>
        <TD>
        Select Keywords, Segments, and Links for table of values.
        <BR>
        <B>4. Select Keywords</B><BR>
        <form id="KeysSelectForm">
          <select id="KeysSelect" size=8 multiple="multiple" onChange="PickKeys();" > </select>
        </form>
        <B>5. Select Segments</B><BR>
        <form id="SegsSelectForm">
          <select id="SegsSelect" size=8 multiple="multiple" onChange="PickSegs();"> </select>
        </form>
        <B>6. Select Links</B><BR>
        <form id="LinksSelectForm">
          <select id="LinksSelect" size=8 multiple="multiple" onChange="PickLinks();" > </select>
        </form>
        </TD>
      </TR>
    </TABLE>
  </DIV> <!-- id="MySeriesDiv" -->
</DIV> <!-- /DIV TabRecSetDiv -->
<DIV id="TabSeriesStructDiv" style="display:block">
  <DIV id="SeriesInfoDiv"  style="background-color:#FFFFFF;border:solid;border-width:thin;overflow:scroll;height:75%">
  <H3>List of All Keywords, Links, and Segments</H3>
    <span id="SSPlace" style="background-color:#FFFFFF;"></span>
  </DIV>
</DIV> <!-- /DIV TabSeriesStructDiv -->
<DIV id="TabDisplayDiv" style="display:block">
  <DIV id="FullInfoDiv">
    <B>7. Get Keyword and Segment Values Here</B><BR>
    <TABLE>
    <TR><TD> RecordSet Query:</TD><TD> <span id="RecSetPlace" style="background-color:#FFFFFF;"></span></TD></TR>
    <TR><TD> Keywords to Fetch:</TD><TD><span id="KeyListPlace" style="background-color:#FFFFFF;"></span></TD></TR>
    <TR><TD> Segments to Fetch:</TD><TD><span id="SegListPlace" style="background-color:#FFFFFF;"></span></TD></TR>
    <TR><TD> Links to Fetch:</TD><TD> <span id="LinkListPlace" style="background-color:#FFFFFF;"></span></TD></TR>
    </TABLE>
	    <P>
	    <DIV id="FullDisplayInfoDiv" style="background-color:#FFFFFF ;width:98%;">
      <span id="DisplayPlace" style="background-color:#FFFFFF;"></span>
    </DIV> <!-- /DIV FullDisplayInfoDiv -->
  </DIV> <!-- /DIV FullInfoDiv -->
</DIV> <!-- /DIV TabDisplayDiv -->
<DIV id="TabExportDiv" style="display:block">
  <DIV> <!-- Section 7, Export link -->
    <H3>Warning - record limit not implemented for export yet</H3>
    <B>8. RecordSet to export:</B>
    <span id="ExportRecordSet" style="background-color:#FFFFFF;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span >
    <input id="ExportRequestButton" type="button" value="Export" onClick="Export_Recordset();" >
    Click to jump to new export page.
    <p>
  </DIV> <!-- /DIV Section 7, Export link -->
</DIV> <!-- /DIV TabExportDiv -->
<DIV id="TabPlotDiv">
  <P>
  Graph Selected Data
  <P>
  <B>4. Select Keywords</B><BR>
  <form id="GraphSelectForm">
    <select id="GraphKeysSelect" size=8 multiple="multiple" onChange="GraphPickKeys();" > </select>
  </form>
  <input type="text" value="-1" name="DateColumn" id="DateColumn" >Date Col 
  <input type="text" value="none" name="PlotColumn" id="PlotColumn" > Column
  <input type="button" value="Create Graph"  style="background-color:#FFFF80" onClick="GraphCreate();" >
  <input type="button" value="Delete Graph"  style="background-color:#FFFF80" onClick="GraphDelete();" >
  <DIV ID="amChartDiv" style="display:block">
    <HR>
    <span id="PlotPlace" style="background-color:#FFFFFF;"></span>
    <div id="flashcontent">
       <strong>No graph created yet</strong>
       <P>
       or if graph made but not showm you may need to upgrade your Flash Player.
    </div>
  </DIV> <!-- ChartReady -->
</DVI> <!-- /DIV TabPlotDiv -->
</DIV> <!-- /DIV Main including all tab divs -->
<P style="height:1px">
<DIV id="footer" style="vertical-align:bottom;text-align:center;">
<HR>
  <I>Home pages for:</I>
  <A HREF = "http://jsoc.stanford.edu/"><B>SDO-JSOC</B></A>
  <B>|</B>
  <A HREF = "http://sha.stanford.edu/"><B>SHA</B></A>
</DIV>
</BODY>
</HTML>

