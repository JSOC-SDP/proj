<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso-8859-1">
<TITLE>JSOC Watch Lev0</TITLE>
<!-- < base HREF='http://' + Host + '/' > -->
<SCRIPT TYPE="text/javascript" SRC="prototype-1.6.0.2.js"></SCRIPT>
 
<script type="text/javascript">

var Host;
var MonitorOn = 1;
var DetailsOn = 0;
var DisplayOn = 0;
var ImagesOn = 0;
var DetailsSeries = "";
var WaitCount;
var UpdateCount = 0;
var Pending;
var updatetimeID = 0;
var ImagesTableExists = 0;
var ImagesSeries = "";
var DisplayWindow; 
var DisplayMade = 0;
var DisplayInst = 1;
var DisplayAuto = 1;
var DisplaySim = 0;
var thistable;
var Wide=0;
var Height=0;
var ThisWindowTime=0;
var DATE_Lag=0;
// set for AIA
var ImagesPerVC = 24;

function InitPage()
  {
  var now = new Date();
  var nowms = now.getTime();
  Host = location.host;
  HelpOnOff();
  ThisWindowTime = Math.round(nowms/1000);
  WaitCount = 0;
  MonitorOn = 0;
  // Turn Details, Images and Display  off.
  DetailsOn = 1;
  ImagesOn = 1;
  DisplayOn = 1;
  DisplayMade = 0;
  DisplayInst = 1;
  DisplayAuto = 1;
  DisplaySim = 0;
  $("ImagesFSN").value = 0;
  $("DetailsFSN").value = 0;
  $("DetailsCount").value = 10;
  $("DetailsMsg").innerHTML = "No Details Requested Yet";
  $("DetailsQuery").innerHTML = "No Details Requested Yet";
  $("ImagesCount").value = 10;
  $("ImagesMsg").innerHTML = "No Images Requested Yet";
  $("ImagesQuery").innerHTML = "No Images Requested Yet";
  $("PickHMI").checked = false;
  $("PickAIA").checked = true;
  $("PickHMI_img").checked = false;
  $("PickAIA_img").checked = true;
  $("PickHMI_disp").checked = false;
  $("PickAIA_disp").checked = true;
  $("DisplayAuto").checked = false;
  $("DisplayMan").checked = true;
  $("DisplaySim").checked = false;
  $("DCS_info").innerHTML = "No DCS Info Requested Yet";
  if (Host == 'jsoc.stanford.edu')
    {
    alert(Host + " does not have lev0 access, please use jsoc2.stanford.edu");
    $("JSOC2DIV").style.display="block";
    }
  else
    $("JSOC2DIV").style.display="none";
  EnableMonitor();
  EnableDetails();
  EnableImages();
  EnableDisplay();
  GetStatus();
  }

function HelpOnOff()
  {
  if ($("HelpCheckbox").checked)
    {
    $("helpdcs").style.display="inline";
    $("helpwatch").style.display="inline";
    $("helpdetails").style.display="inline";
    $("helpimages").style.display="inline";
    $("helpdisplay").style.display="inline";
    }
  else
    {
    $("helpdcs").style.display="none";
    $("helpwatch").style.display="none";
    $("helpdetails").style.display="none";
    $("helpimages").style.display="none";
    $("helpdisplay").style.display="none";
    }
  }

function EnableMonitor()
  {
  MonitorOn = 1 - MonitorOn;
  if (MonitorOn)
    {
    $("MonitorButton").style.backgroundColor = "D8FFD8";
    $("MonitorButton").value = "Watch On";
    $("StatusDiv").style.display="inline";
    GetStatus();
    }
  else
    {
    $("MonitorButton").style.backgroundColor = "FFD8D8";
    $("MonitorButton").value = "Watch Off";
    $("StatusDiv").style.display="none";
    }
  }

function EnableDisplay()
  {
  DisplayOn = 1 - DisplayOn;
  if (DisplayOn)
    {
    $("DisplayButton").style.backgroundColor = "D8FFD8";
    $("DisplayButton").value = "Display On";
    $("Display").style.display="inline";
    GetStatus();
    }
  else
    {
    $("DisplayButton").style.backgroundColor = "FFD8D8";
    $("DisplayButton").value = "Display Off";
    $("Display").style.display="none";
    if (DisplayMade)
      {
      DisplayWindow.close();
      DisplayMade = 0;
      }
    }
  }

function EnableImages()
  {
  ImagesOn = 1 - ImagesOn;
  if (ImagesOn)
    {
    $("ImagesButton").style.backgroundColor = "D8FFD8";
    $("ImagesButton").value = "Images On";
    $("Images").style.display="inline";
    GetImagesTable();
    }
  else
    {
    $("ImagesButton").style.backgroundColor = "FFD8D8";
    $("ImagesButton").value = "Images Off";
    $("Images").style.display="none";
    }
  }

function EnableDetails()
  {
  DetailsOn = 1 - DetailsOn;
  if (DetailsOn)
    {
    $("DetailsButton").style.backgroundColor = "D8FFD8";
    $("DetailsButton").value = "Details On";
    $("Details").style.display="inline";
    GetDetailsTable();
    }
  else
    {
    $("DetailsButton").style.backgroundColor = "FFD8D8";
    $("DetailsButton").value = "Details Off";
    $("Details").style.display="none";
    }
  }

function GetStatus()
  {
  GetDCSInfo();
  GetTlmStatus();
  // GetLev0Status(); - called by GetTlmStatus
  // GetRecnumPaths(); - called by GetLev0Status
  // if (DetailsOn)
  //  GetDetailsTable(); - called by GetRecnumPaths
  //if (ImagesOn)
  //  GetImagesTable(); - called by GetDetailsTable
  //if (DisplayOn)
  //  UpdateDisplayTable(); - called be GetImagesTable
  clearTimeout(updatetimeID);
  if ($("UpdateRate").value > 0)
    {
    UpdateCount = -1;
  StartUpdating();
    }
  now = new Date();
  $("NOW_local").innerHTML = now.toLocaleString();
  $("NOW_UT").innerHTML = now.toUTCString();
  }

function StartUpdating()
  {
  UpdateCount += 1;
  $("LastUpdateTxt").innerHTML = UpdateCount;
  updatetimeID = setTimeout("StartUpdating()", 1000);
  CheckPending();
  if ($("UpdateRate").value > 0 && UpdateCount >= $("UpdateRate").value)
    {
    if (DisplaySim)
      $("DisplayMaxFSN").value = 1.0*$("DisplayMaxFSN").value + ImagesPerVC;
    GetStatus();
    }
  if ($("UpdateRate").value <= 0)
    clearTimeout(updatetimeID);
  }

function CheckPending()
  {
  Pending = Ajax.activeRequestCount;
  if (Pending > 0)
    {
    $("PendingMessagePlace").innerHTML = Pending + " Prior Request(s) pending, " + WaitCount + "(sec)";
    WaitCount += 1;
    if (WaitCount > 20)
      {
      WaitCount = 0;
      }
    }
  else
    {
    WaitCount = 0;
    $("PendingMessagePlace").innerHTML = Pending + " Prior Request(s) pending, " + WaitCount + "(sec)";
    }
  }

// Returns difference in minutes between ISO time string t and the present time
function TimeSinceFNT(t)
  {
  now = new Date();
  nowms = now.getTime();
  t0 = new String(t);
  yr = t0.substring(5,9);
  doy = t0.substring(10,13);
  hr = t0.substring(14,16);
  min = t0.substring(17,19);
  sec = t0.substring(20,22);
  t1 = yr + "/01/01 "+ hr +":"+ min +":"+ sec;
  tms = Date.UTC(yr,0,1,hr,min,sec);
  tms = tms + 86400000 * (doy - 1);
  diff = Math.round((nowms - tms)/60000);
  hrs = Math.floor(diff/60);
  mins = diff - 60*hrs;
  return hrs.toPaddedString(2) + "h " + mins.toPaddedString(2) + "m";
  }

// Returns difference in minutes between ISO time string t and the present time
function TimeSinceISO(t)
  {
  now = new Date();
  nowms = now.getTime();
// example 2008/06/22 21:45:32
  t0 = new String(t);
  t1 = t0.replace(/-/g,"/");
  t0 = t1.replace(/T/," ");
  t1 = t0.substring(0,19);
  tms = Date.parse(t1);
  tms = tms - 60000*now.getTimezoneOffset();
  diff = Math.round((nowms - tms)/60000);
  DATE_Lag = diff;
  hrs = Math.floor(diff/60);
  mins = diff - 60*hrs;
  return hrs.toPaddedString(2) + "h " + mins.toPaddedString(2) + "m";
  }

// Returns difference in minutes between JSOC time string t and the present time
function TimeSinceJSOC(t)
  {
  now = new Date();
  nowms = now.getTime();
// example 2008.06.23_00:58:42.95_TAI
  t0 = new String(t);
  t1 = t0.replace(/\./g,"/");
  t0 = t1.replace(/_/," ");
  t1 = t0.substring(0,19);
  tms = Date.parse(t1);
  tms = tms - 60000*now.getTimezoneOffset();
  diff = Math.round((nowms - tms)/60000);
  hrs = Math.floor(diff/60);
  mins = diff - 60*hrs;
  return hrs.toPaddedString(2) + "h " + mins.toPaddedString(2) + "m";
  }

// Primary data access sections

function GetDCSInfo()
  {
  new Ajax.Request('http://' + Host + '/~jsoc/dcs_times.json',
    {
    method: 'get',
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      $("DCS_info").innerHTML = "<B>ingest_lev0 time:</B>&nbsp;&nbsp;";
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "&nbsp;&nbsp;VC01: " + (data.VC01 === "OFF" ? data.VC01.blink() : data.VC01);
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "&nbsp;&nbsp;VC02: " + (data.VC02 === "OFF" ? data.VC02.blink() : data.VC02);
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "&nbsp;&nbsp;VC04: " + (data.VC04 === "OFF" ? data.VC04.blink() : data.VC04);
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "&nbsp;&nbsp;VC05: " + (data.VC05 === "OFF" ? data.VC05.blink() : data.VC05);
      $("DCS_info").innerHTML = $("DCS_info").innerHTML + "<BR><B>Most Recent Remaining DCS Files:</B> " + data.hmilast + " and " + data.aialast + "<BR>";
      var now, nowms, diff, hrs, mins;
      now = new Date();
      nowms = now.getTime();
      dcslast = data.hmimt * 1000;
      diff = Math.round((nowms - dcslast)/60000);
      hrs = Math.floor(diff/60);
      mins = diff - 60*hrs;
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "<B>Last DCS Received HMI</B> file was " +  hrs.toPaddedString(2) + "h " + mins.toPaddedString(2) + "m ago,";
      dcslast = data.aiamt * 1000;
      diff = Math.round((nowms - dcslast)/60000);
      hrs = Math.floor(diff/60);
      mins = diff - 60*hrs;
      $("DCS_info").innerHTML =  $("DCS_info").innerHTML + "  <B>AIA</B> file was " +  hrs.toPaddedString(2) + "h " + mins.toPaddedString(2) + "m ago";
      },
    onFailure: function()
      {
      $("ErrorMessagePlace").innerHTML = "Something went wrong with DCS info.";
      }
    });
  }

function GetTlmStatus()
  {
  new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds":$("HmiTlmSeriesTxt").value + "[:#$]," + $("AiaTlmSeriesTxt").value + "[:#$]", "op":"rs_list", "key":"filename,*dirmtime*" },
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0)
        {
        $("HMI_tlm").innerHTML = data.status + ", " + data.error;
        $("AIA_tlm").innerHTML = data.status + ", " + data.error;
        }
      else
        {
	$("HMI_tlm").innerHTML = data.keywords[0].values[0];
	$("HMI_tlm_LAG").innerHTML = TimeSinceFNT(data.keywords[0].values[0]);
	$("HMI_tlm_mtime").innerHTML = data.keywords[1].values[0];
	$("HMI_tlm_mtime_LAG").innerHTML = TimeSinceJSOC(data.keywords[1].values[0]);
	$("AIA_tlm").innerHTML = data.keywords[0].values[1];
	$("AIA_tlm_LAG").innerHTML = TimeSinceFNT(data.keywords[0].values[1]);
	$("AIA_tlm_mtime").innerHTML = data.keywords[1].values[1];
	$("AIA_tlm_mtime_LAG").innerHTML = TimeSinceJSOC(data.keywords[1].values[1]);
        GetLev0Status();
        }
      },
    onFailure: function()
      {
      $("ErrorMessagePlace").innerHTML = "Something went wrong.";
      }
    });
  }

function GetLev0Status()
  {
  $("ErrorMessagePlace").innerHTML = "";
  new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds":$("HmiLev0SeriesTxt").value + "[:#$]," + $("AiaLev0SeriesTxt").value + "[:#$]",
        "op":"rs_list",
        "key":"T_OBS,DATE,*recnum*,FSN",
	"seg":"image"},
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0 )
        {
        $("HMI_lev0_DATE").innerHTML = data.status + ", " + data.error;
        $("AIA_lev0_DATE").innerHTML = data.error;
        }
      else if (data.count < 2)
        { 
        $("HMI_lev0_DATE").innerHTML = "One of HMI or AIA lev0 series not found";
        $("AIA_lev0_DATE").innerHTML = "One of HMI or AIA lev0 series not found";
        }
      else
        {
	$("HMI_lev0_FSN").innerHTML = data.keywords[3].values[0];
	$("HMI_lev0_T_OBS").innerHTML = data.keywords[0].values[0];
	$("HMI_lev0_T_OBS_LAG").innerHTML = TimeSinceJSOC(data.keywords[0].values[0]);
	$("HMI_lev0_DATE").innerHTML =  data.keywords[1].values[0];
	$("HMI_lev0_DATE_LAG").innerHTML = TimeSinceISO(data.keywords[1].values[0]);
        if ($("HMI_Alert").value > 0 && DATE_Lag >= $("HMI_Alert").value)
            {
            $("HMI_lev0_DATE_LAG").style.backgroundColor="red";
            $("HMI_lev0_DATE_LAG").style.textDecoration="none";
            if (DATE_Lag >= 4 * $("HMI_Alert").value)
              $("HMI_lev0_DATE_LAG").style.textDecoration="blink";
            }
        else
	    {
            $("HMI_lev0_DATE_LAG").style.backgroundColor="white";
            $("HMI_lev0_DATE_LAG").style.textDecoration="none";
            }
	HMI_This_recnum = data.keywords[2].values[0];
	HMIpath = data.segments[0].values[0];
	$("HMI_lev0_recnum").innerHTML = "<A HREF="+HMIpath+">"+HMI_This_recnum+"</A>";

        if ($("PickHMI").checked == true)
	  {
	  $("DetailsFSN").value = data.keywords[3].values[0] - $("DetailsCount").value + 1;
	  DetailsSeries = $("HmiLev0SeriesTxt").value;
	  }
        if ($("PickHMI_img").checked == true)
	  {
	  $("ImagesFSN").value = data.keywords[3].values[0] - $("ImagesCount").value + 1;
	  ImagesSeries = $("HmiLev0SeriesTxt").value;
	  }
        if ($("PickHMI_disp").checked == true)
	  {
          if (DisplayInst == 1)
            if (DisplayMade >= 2)
              DisplayMade = 1;
          DisplayInst = 0;
	  if (DisplayAuto)
	    $("DisplayMaxFSN").value = data.keywords[3].values[0];
	  DisplaySeries = $("HmiLev0SeriesTxt").value;
	  }


	$("AIA_lev0_FSN").innerHTML = data.keywords[3].values[1];
	$("AIA_lev0_T_OBS").innerHTML = data.keywords[0].values[1];
	$("AIA_lev0_T_OBS_LAG").innerHTML = TimeSinceISO(data.keywords[0].values[1]);
	$("AIA_lev0_DATE").innerHTML =  data.keywords[1].values[1];
	$("AIA_lev0_DATE_LAG").innerHTML = TimeSinceISO(data.keywords[1].values[1]);
        if ($("AIA_Alert").value > 0 && DATE_Lag >= $("AIA_Alert").value)
            {
            $("AIA_lev0_DATE_LAG").style.backgroundColor="red";
            $("AIA_lev0_DATE_LAG").style.textDecoration="none";
            if (DATE_Lag >= (4 * $("AIA_Alert").value))
              $("AIA_lev0_DATE_LAG").style.textDecoration="blink";
            }
        else
            {
            $("AIA_lev0_DATE_LAG").style.backgroundColor="white";
            $("AIA_lev0_DATE_LAG").style.textDecoration="none";
            }
	AIA_This_recnum = data.keywords[2].values[1];
	AIApath = data.segments[0].values[1];
	$("AIA_lev0_recnum").innerHTML = "<A HREF="+AIApath+">"+AIA_This_recnum+"</A>";

        if ($("PickAIA").checked == true)
	  {
	  $("DetailsFSN").value = data.keywords[3].values[1] - $("DetailsCount").value + 1;
	  DetailsSeries = $("AiaLev0SeriesTxt").value;
	  }
        if ($("PickAIA_img").checked == true)
	  {
	  $("ImagesFSN").value = data.keywords[3].values[1] - $("ImagesCount").value + 1;
	  ImagesSeries = $("AiaLev0SeriesTxt").value;
	  }
        if ($("PickAIA_disp").checked == true)
	  {
          if (DisplayInst == 0)
            if (DisplayMade >= 2)
              DisplayMade = 1;
          DisplayInst = 1;
	  if (DisplayAuto)
	    $("DisplayMaxFSN").value = data.keywords[3].values[1];
	  DisplaySeries = $("AiaLev0SeriesTxt").value;
	  }

        GetDetailsTable();
        }
      },
    onFailure: function()
      {
      $("ErrorMessagePlace").innerHTML = "Something went wrong.";
      }
    });
  }

function GetDetailsTable()
  {
  if (!DetailsOn)
    {
    GetImagesTable();
    return;
    }
  $("ErrorMessagePlace").innerHTML = "";

  var F_FSN = $("DetailsFSN").value - 0;
  var L_FSN = (F_FSN - 0) + ($("DetailsCount").value - 1);
  $("DetailsQuery").innerHTML = "Getting new data for " + DetailsSeries + "[" + F_FSN + "-" + L_FSN + "]";
  DetailsReq = new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds":DetailsSeries + "[" + F_FSN + "-" + L_FSN + "]",
		 "op":"rs_list",
		 "key":"FSN,T_OBS,DATE,CAMERA,WAVELNTH,EXPTIME,MISSVALS,NERRORS,DATAMIN,DATAMAX,DATAMEAN,DATARMS,*recnum*",
		 "seg":"image" },
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0)
        {
        $("DetailsTable").innerHTML = data.status + ", " + data.error;
        }
      else
        {
	DetailsText = "<table border=1 cellPadding=2 cellSpacing=5 ><tr>" + 
		"<th>FSN</th>" + "<th>T_OBS</th>" + "<th>DATE</th>" +
		"<th>CAM</th>" + "<th>WAVE</th>" + "<th>EXPTIME</th>" + "<th>MISSVALS</th>" + "<th>NERRORS</th>" + "<th>MIN</th>" +
		"<th>MAX</th>" + "<th>MEAN</th>" + "<th>RMS</th>" +
		"<th>recnum</th>" + "<th>Link</th>" + "<th>Small</th>" +
		"<th>.png</th>" + "</tr>";
	n = data.count;
        if (n > 0)
          {
	  for (row=n-1; row >= 0; row--)
	    {
	    DetailsText = DetailsText + "<tr>"; 
            for (var key=0; key<11; key++)
		DetailsText = DetailsText + "<td>" + data.keywords[key].values[row] + "</td>";
	    var path = data.segments[0].values[row];
	    DetailsText = DetailsText + "<td><a href=" + path + ">Full FITS</a></td>";
	    var pathsm = path.replace(/.fits/,"_sm.fits");
	    DetailsText = DetailsText + "<td><a href=" + pathsm + ">Small FITS</a></td>";
	    var pathim = path.replace(/.fits/,".png");
	    DetailsText = DetailsText + "<td><a href=" + pathim + ">Image</a></td>";
	    DetailsText = DetailsText  + "</tr>";
	    }
	  DetailsText = DetailsText + "</table>";
	  $("DetailsTable").innerHTML = DetailsText;
	  }
	$("DetailsMsg").innerHTML = n + " records found";
        }
      GetImagesTable();
      },
    onFailure: function()
      {
      WaitCount = 0;
      $("DetailsTable").innerHTML = "";
      $("DetailsMsg").innerHTML = "Request Failed";
      $("ErrorMessagePlace").innerHTML = "Something went wrong.";
      }
    });
  }

function GetImagesTable()
  {
  if (!ImagesOn)
    {
    GetFsnRangeForDisplay();
    return;
    }
  $("ErrorMessagePlace").innerHTML = "";

  var F_FSN = $("ImagesFSN").value - 0;
  var L_FSN = (F_FSN - 0) + ($("ImagesCount").value - 1);
  $("ImagesQuery").innerHTML = "Images for " + ImagesSeries + "[" + F_FSN + "-" + L_FSN + "]";
  ImagesReq = new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds":ImagesSeries + "[" + F_FSN + "-" + L_FSN + "]",
		 "op":"rs_list",
		 "key":"FSN,*recnum*",
		 "seg":"image" },
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0)
        {
        $("ImagesTable").innerHTML = data.status + ", " + data.error;
        }
      else
        {
	ImagesText = "<table border=1 cellPadding=2 cellSpacing=5 ><tr>" + 
		"<th>FSN</th><th>Image</th></tr>";
	n = data.count;
        if (n > 0)
	  {
	  for (row=n-1; row >= 0; row--)
	    {
	    var FSN = data.keywords[0].values[row];
	    var recnum = data.keywords[1].values[row];
	    var path = data.segments[0].values[row];
	    var pathim = path.replace(/.fits/,".png");
	    var pathsm = path.replace(/.fits/,"_sm.fits");
	    ImagesText = ImagesText + "<tr><td>FSN = " + FSN + "<br>&nbsp;<br>rec = " + recnum + "</td>" +
		"<td><a href=" + pathsm + "><img src=" + pathim + "></a></td></tr>";
	    }
	  ImagesText = ImagesText + "</table>";
	  $("ImagesTable").innerHTML = ImagesText;
	  }
	$("ImagesMsg").innerHTML = n + " records found";
        }
      GetFsnRangeForDisplay();
      },
    onFailure: function()
      {
      WaitCount = 0;
      $("ImagesTable").innerHTML = "";
      $("ImagesMsg").innerHTML = "Request Failed";
      $("ErrorMessagePlace").innerHTML = "Something went wrong.";
      GetFsnRangeForDisplay();
      }
    });
  }
    
// Keep cache of the last cacheSize images FSN requested.  Cache is emptied on change of seriesname (implies instrument)
// cache contains FSN, camera, path to record directory, and an Image object to allow prefetching
// of images.  Cache is implemented as an array indexed on FSN and is filled in a cirle.
// 5th item is state of image, 0=not defined, 1=image added, not displayed, 2=image in current screen.
var cacheSeries;
var cacheSize;
var cacheMaxSize;
var cacheArray;
var cachePtr; // index of most recent lookup;

function addToCache(FSN,nmiss,camera,path)
  {
  if (cacheArray == undefined)
	{
        cacheArray = new Array(1);
	cacheSeries = DisplaySeries;
	cacheSize = 0;
	cacheMaxSize = 500;
	cachePtr = cacheSize - 1; // index of most recent lookup;
        }
  if (cacheSize +1 >= cacheMaxSize)
    {
    cacheArray.shift();
    cacheSize -= 1;
    }
  var newrec = new Array(5);
  newrec[0] = FSN;
  newrec[1] = nmiss;
  newrec[2] = camera;
  newrec[3] = path;
  newrec[4] = 1;
  if (cacheSize == 0)
    {
    cacheArray[0] = newrec;
    cacheSize = 1;
    }
  else
    {
    cacheSize = cacheArray.push(newrec);
    }
  }
  
function lookupCache(FSN)
  {
  for (cachePtr = cachePtr + 1; cachePtr < cacheSize; cachePtr++)
    if (cacheArray[cachePtr][0] == FSN)
      return(cacheArray[cachePtr]);
  for (cachePtr = 0; cachePtr < cacheSize; cachePtr++)
    if (cacheArray[cachePtr][0] == FSN)
      return(cacheArray[cachePtr]);
  return(null);
  }
      
/*

Display table logic
Table will be in a detached window that can be moved and resized and will contain
only images and a small box under each image with some key info.
The background color should be changable based on CAMERA or on next victim basis.

The table will contain a range of FSN, ending in the greatest FSN when in automatic mode.
Imn manual mode, the starting FSN can be specified.  In both modes the final FSN in the
table will be in a label.  Window title bar is perhaps the place to show seriesname
and final FSN shown.

Manual mode is simple, just get the range of fsn and fill out the table.

Auto mode more complex about which images to refresh.
Later will need to refresh based on prior completeness, prior missing, etc.

When adding a range of new FSNs init the table with blank images.

First implementation just fetch the range of FSNs then build the table
sticking in blanks where FSN did not get returned in the query.

Do auto mode first.

 */

function GetFsnRangeForDisplay()
  {
  if (!DisplayOn)
    {
    return;
    }
  $("ErrorMessagePlace").innerHTML = "";

  // in automatic mode use the most recent FSN
  var Prev_FSN = 0;
  var F_FSN;
  var L_FSN;
  var rows = $("DisplayRows").value;
  var cols = $("DisplayCols").value;
  if (DisplayAuto || DisplaySim) // auto mode 
    {
    L_FSN = $("DisplayMaxFSN").value; 
    F_FSN = L_FSN - (rows * cols - 1);
    $("DisplayMinFSN").value = F_FSN;
    }
  else if (DisplaySim) // simulation of normal ops auto mode
    {
    F_FSN = $("DisplayMinFSN").value;
    L_FSN = (F_FSN - 0) + (rows * cols - 1);
    $("DisplayMaxFSN").value = L_FSN;
    }

  $("DisplayQuery").innerHTML = "Images for " + DisplaySeries + "[" + F_FSN + "-" + L_FSN + "]";
  DisplayReq = new Ajax.Request('http://' + Host + '/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds":DisplaySeries + "[" + F_FSN + "-" + L_FSN + "]",
                 "op":"rs_list",
                 "key":"FSN,MISSVALS,CAMERA,WAVELNTH",
                 "seg":"image" },
    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0)
        {
        $("DisplayMessage").innerHTML = data.status + ", " + data.error;
        }
      else
        {
        n = data.count;
        if (n > 0)
          {
          for (rec=n-1; rec >= 0; rec--)
            {
            var FSN = data.keywords[0].values[rec];
            var NMISS = data.keywords[1].values[rec];
            var camera = data.keywords[2].values[rec] + ", " + data.keywords[3].values[rec];
            var path = data.segments[0].values[rec];
            var pathim = path.replace(/.fits/,".png");
            addToCache(FSN,NMISS,camera,pathim);
            }
          }
        $("DisplayMessage").innerHTML = n + " records found";
        }
      UpdateDisplayTable();
      },
    onFailure: function()
      {
      WaitCount = 0;
      $("ErrorMessagePlace").innerHTML = "Something went wrong.";
      UpdateDisplayTable()
      }
    });
  }

// DisplayMade 0 -- need tables and dimensions
//             1 -- need to init table for instrument
//             2 -- need to simply update
function UpdateDisplayTable()
  {
  if (!DisplayOn)
    {
    return;
    }
  var rows = $("DisplayRows").value;
  var cols = $("DisplayCols").value;
  var L_FSN = $("DisplayMaxFSN").value;
  var F_FSN = $("DisplayMinFSN").value;
  var FSN = F_FSN - 1;
  var nmiss, pathim, row, col, pathim, camera, thisimage;
  var thisimage;
  var newWide, newHeight;

  var blankimage = new Array(5);
  blankimage[0] = 0;
  blankimage[1] = 0;
  blankimage[2] = 0;
  blankimage[3] = "/ajax/white256.gif";
  blankimage[4] = 0;

  if (DisplayMade == 0 || DisplayWindow.closed)
    {
    TabWidth = 750;
    TabHeight = 900;
    DisplayMade = 0;
    }
  else
    {
    TabWidth = DisplayWindow.document.documentElement.clientWidth;
    TabHeight = DisplayWindow.document.documentElement.clientHeight;
    }
  newWide = Math.floor((TabWidth-20)/cols) -1;
  newHeight = Math.floor((TabHeight-20)/rows) - 60;

  // if (newHeight<newWide) newWide = newHeight;

  // if (Math.round(Wide*100) != Math.round(newWide*100) || Math.round(Height*100) != Math.round(newHeight*100))
  if (Math.round(Wide*100) != Math.round(newWide*100) )
    DisplayMade = 0;
  Wide = newWide;
  Height = newWide;

  if (DisplayMade<2)
    {
    thistable = new Array(rows+1);
    for (row=0; row<rows; row++)
      {
      thistable[row] = new Array(cols);
      for (col=0; col<cols; col++)
        thistable[row][col] = blankimage;
      }
    }

  for (FSN=F_FSN; FSN <= L_FSN; FSN++)
    {
    col = Math.floor(FSN % cols);
    row = Math.floor((FSN / cols) % rows);
    thisimage = lookupCache(FSN);
    if (DisplayMade<2 || thistable[row][col][0] != FSN || thistable[row][col][4] < 2 || thistable[row][col][1] > 0)
      {
      if (thisimage==null)
        {
        thistable[row][col] = blankimage;
        thistable[row][col][0] = "TBD";
        }
      else
        thistable[row][col] = thisimage;
      }
    }

  if (DisplayMade < 2)
    {
    var cam;
    DisplayText = "<table id='DT' border=0 cellPadding=1 cellSpacing=0 >";
    for (row=0; row<rows; row++)
      {
      DisplayText = DisplayText + "<tr>"
      for (col=0; col<cols; col++)
        {
        pathim = thistable[row][col][3];
        var pathsm = pathim.replace(/.png/,"_sm.fits");
        var hrefcmd = "<a href="+pathsm+"><img src="+pathim+" border=0 width="+Wide+"height="+Height+"></a>";
        var cellIdIm = "cimg_"+col+"_"+row;
        DisplayText = DisplayText + '<td id="'+cellIdIm+'"'+" >"+hrefcmd+"</td>";
        thistable[row][col][4] = (FSN==L_FSN ? 1 : 2);
        }
      DisplayText = DisplayText + "</tr><tr>"
      for (col=0; col<cols; col++)
        {
        FSN = thistable[row][col][0];
        nmiss = thistable[row][col][1];
        camera = thistable[row][col][2];
        if (camera.length > 0)
           cam = camera.substr(0,1);
        else
          cam = 0;
        if ($("PickHMI_disp").checked == false)
          {
          if (FSN == F_FSN)
            color = "BGCOLOR='lightgrey'";
          else if (cam == 1)
            color = "BGCOLOR='lightblue'";
          else if (cam == 2)
            color = "BGCOLOR='pink'";
          else if (cam == 3)
            color = "BGCOLOR='lightgreen'";
          else if (cam == 4)
            color = "BGCOLOR='#ffff80'";
          else
            color = "BGCOLOR='white'";
          }
        else
          {
          if (cam == 1)
            color = (FSN==L_FSN ? "BGCOLOR='#0080FF'" : "BGCOLOR='#00d0f0'");
          else if (cam == 2)
            color = (FSN==L_FSN ? "BGCOLOR='#FF4010'" : "BGCOLOR='#FFB080'");
          else
            color = "BGCOLOR='white'";
          }

        var cellIdTx = "ctxt_"+col+"_"+row;
        DisplayText = DisplayText + '<td id="'+cellIdTx+'" '+color+">FSN="+FSN+"<br>CAM="+camera+"<br>Nmiss="+nmiss+"</td>";
        }
      DisplayText = DisplayText + "</tr>"
      }
    DisplayText = DisplayText + "</table>"
  

    DisplayWindow = window.open("about:blank", ThisWindowTime,
        "width="+TabWidth+",height="+TabHeight+",directories=no,location=no,menubar=no,toolbar=no,titlebar=no");
  
    DisplayWindow.document.write(DisplayText);
    DisplayWindow.document.close();
    DisplayMade = 2;
    }
  else
    {
    for (row=0; row<rows; row++)
      {
      for (col=0; col<cols; col++)
        if (thistable[row][col][4] < 2)
          {
          pathim = thistable[row][col][3];
          var pathsm = pathim.replace(/.png/,"_sm.fits");
          var CellImgTxt = "<a href="+pathsm+"><img src="+pathim+" border=0 width="+Wide+"height="+Height+"></a>";
          var cellIdIm = "cimg_"+col+"_"+row;
          var cellIdIm = "cimg_"+col+"_"+row;
          DisplayWindow.document.getElementById(cellIdIm).innerHTML = CellImgTxt;
          FSN = thistable[row][col][0];
          nmiss = thistable[row][col][1];
          camera = thistable[row][col][2];
          if (camera.length > 0)
             cam = camera.substr(0,1);
          else
            cam = 0;
          var cellIdTx = "ctxt_"+col+"_"+row;
          var CellTxtTxt = "FSN="+FSN+"<br>CAM="+camera+"<br>Nmiss="+nmiss;
          DisplayWindow.document.getElementById(cellIdTx).innerHTML = CellTxtTxt;
          if ($("PickHMI_disp").checked == false)
            {
            if (FSN == F_FSN)
              bgcolor = "lightgrey";
            else if (cam == 1)
              bgcolor = "lightblue";
            else if (cam == 2)
              bgcolor = "pink";
            else if (cam == 3)
              bgcolor = "lightgreen";
            else if (cam == 4)
              bgcolor = "#ffff80";
            else
              bgcolor = "white";
            }
          else
            {
            if (cam == 1)
              bgcolor = (FSN==L_FSN ? "#0080FF" : "#00d0f0");
            else if (cam == 2)
              bgcolor = (FSN==L_FSN ? "#FF4020" : "#FFB080");
            else
              bgcolor = "white";
            }

          DisplayWindow.document.getElementById(cellIdTx).style.backgroundColor = bgcolor;
          thistable[row][col][4] = (FSN==L_FSN ? 1 : 2);
          }
      }
    }
  DisplayWindow.focus();
  }

function SetDisplayMode()
  {
  DisplayAuto = 1;
  DisplaySim = 0;
  }

function ClearDisplayMode()
  {
  DisplayAuto = 0;
  DisplaySim = 0;
  }

function SetSimDisplayMode()
  {
  DisplayAuto = 0;
  DisplaySim = 1;
  $("DisplayMaxFSN").value = $("DisplaySimSN").value;
  }

</script>

</HEAD>

<BODY BGCOLOR="#FFFFFF" onload="InitPage();" >

<DIV ID="header">
<TABLE >
<TR>
<TD>
<IMG src="http://hmi.stanford.edu/images/web/JSOC_120.gif"
  style="vertical-align:middle;height:60" alt="JSOC logo">
</TD><TD>
<B><big style="vertical-align:middle">&nbsp;&nbsp;JSOC Watch Level-0</big></B>
<BR>
<span id="ErrorMessagePlace" value="" >&nbsp;</span>
<BR>
<span id="PendingMessagePlace" value="" ></span>
</TD><TD>
<input type="button" value="Update Page" style="background-color:#D8FFD8" onClick="GetStatus();" >
<BR>
&nbsp;
<BR>
<input id="MonitorButton" type="button" value="Hide Monitor" style="background-color:#D8FFD8" onClick="EnableMonitor();" >
</TD><TD>
<input id="DetailsButton" type="button" value="Enable Details" style="background-color:#D8FFD8" onClick="EnableDetails();" >
<BR>
<input id="ImagesButton" type="button" value="Enable Images" style="background-color:#D8FFD8" onClick="EnableImages();" >
<BR>
 <input id="DisplayButton" type="button" value="Enable Display" style="background-color:#D8FFD8" onClick="EnableDisplay();" > 
</TD>
<TD>
Last Update <span id="LastUpdateTxt" value="N.A." ></span>
<BR>
&nbsp;
<BR>
Update each <input type="text" id="UpdateRate" style="width:30"  value="0" onchange="GetStatus();" > secs.
</TD>
</TR>
<TR>
<TD colspan=1>
<TD align="right">Update Time =&nbsp;</TD>
<TD colspan=3>
<span id="NOW_local"     value="&nbsp;" style="background-color:#FFFFFF"></span>
</TR>
<TR>
<TD> <input  type="checkbox" id="HelpCheckbox" name="HelpCheckbox" value="true" onclick="HelpOnOff()" >&nbsp;Help </TD>
<TD></td>
<TD colspan=3>
<span id="NOW_UT"     value="&nbsp;" style="background-color:#FFFFFF"></span>
</TD>
</TR>
</TABLE>
<HR>
</DIV> <!-- end DIV header -->
<DIV id="JSOC2DIV">
<P>
<B>
Please use jsoc2.stanford.edu for watch_lev0
</B>
<P>
<HR>
</DIV>

<DIV id="StatusDiv">
<P>
<!-- watch hmi.tlm, hmi.lev0, aia.tlm, aia.lev0 -->
<TABLE border="0" cellpadding="3">
<TITLE>Most Recent Files Processed by DCS</TITLE>
<TR> <TD colspan=7><span id="DCS_info" value="&nbsp;" </span></TD> </TR>
</TABLE>
</div>
<div id="helpdcs">
This section gives information about the most recent file activity in the Data Capture System (DCS).
Two checks are made. 
<P>
The first line contains, for each instrument, the most recent file in the directory used
to send data from the DCS to the Pipeline system for level-0 processing.  The most common file name to see
here is the most recent "dsf" file.  These are the hourly summary files sent by the DDS.  The filename contains
the time as year, doy, hour, minute.  They come on the hour.  This is the same directory that will also contain
the per-minute XXXX.tlm and XXXX.qac files.  When the ingest_lev0 program is running the XXXX.tlm file is processed
and removed as soon as the XXXX.qac file arrives (it is also then removed).  Once in a while you will see one
of these files if you update this page after the per-minute files arrive but before they are processed.  Compare the
file time with the current time to see if there is unexpected lag.  If the most recent file is older than the
start of the current hour then is is likely that the DCS is down.  If, on the other hand, a .dsf file is present and
dated at the start of the current hour then is is most likely that both the DDS and DCS are functioning OK.
<P>
The second line contains additional information about the same transfer directory.  In this case it shows the difference
between the time this page is updated and the last time a change was made in the transfer directory.  In the normal case
this will be the time the most recent XXXX.qac file was removed after it was processed.  In these cases the lag time shown
here should be very nearly the same as the lag time shown in the "Watch" section below for the "dir_mtime" and the "DATE" times -or- in the case that
no data has been sent for a while, the lag will be the same as the number of minutes in the current hour since the last
directory change will have been the arrival of the hourly .dsf file.  If this lag is less than the current "minute-hand"
and if it differs from the dir_mtime this is is possible that the ingest_lev0 program has stopped and the JSOC-SDP should
be alerted.

</div>
<DIV id="StatusDiv">
<TABLE border="0" cellpadding="3">
<TITLE>Most Recent File/Image Processed</TITLE>
<TR> <TD colspan=7><hr></TD> </TR>
<TR> 
<TH>Series</TH>
<TH>FSN</TH>
<TH>Keyword</TH>
<TH>TIME</TH>
<TH>LAG</TH>
<TH>Alert</TH>
<TH>recnum</TH>
</TR>
<TR> <TD colspan=7><hr></TD> </TR>
<TR>
<TD> <input type="text" name="HmiTlmSeriesTxt" id="HmiTlmSeriesTxt" value="hmi.tlm" onchange="GetStatus();"> </TD>
<TD>&nbsp;</TD>
<TD>filename</TD>
<TD><span id="HMI_tlm"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="HMI_tlm_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
</TR>
<TR>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
<TD>dir_mtime</TD>
<TD><span id="HMI_tlm_mtime"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="HMI_tlm_mtime_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
</TR>
<TR>
<TD> <input type="text" name="HmiLev0SeriesTxt" id="HmiLev0SeriesTxt" value="hmi.lev0a" onchange="GetStatus();"> </TD>
<TD><span id="HMI_lev0_FSN" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>DATE</TD>
<TD><span id="HMI_lev0_DATE"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="HMI_lev0_DATE_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><input type="text" size=3 id="HMI_Alert"  value="&nbsp;" style="background-color:#FFFFFF"></TD>
<TD><span id="HMI_lev0_recnum"    value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
</TR>
<TR>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
<TD>T_OBS</TD>
<TD><span id="HMI_lev0_T_OBS"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="HMI_lev0_T_OBS_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
</TR>
<TR> <TD colspan=7><hr></TD> </TR>
<TR>
<TD> <input type="text" name="AiaTlmSeriesTxt" id="AiaTlmSeriesTxt" value="aia.tlm" onchange="GetStatus();"> </TD>
<TD>&nbsp;</TD>
<TD>filename</TD>
<TD><span id="AIA_tlm"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="AIA_tlm_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
</TR>
<TR>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
<TD>dir_mtime</TD>
<TD><span id="AIA_tlm_mtime"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="AIA_tlm_mtime_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
</TR>
<TR>
<TD> <input type="text" name="AiaLev0SeriesTxt" id="AiaLev0SeriesTxt" value="aia.lev0" onchange="GetStatus();"> </TD>
<TD><span id="AIA_lev0_FSN"       value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>DATE</TD>
<TD><span id="AIA_lev0_DATE"      value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="AIA_lev0_DATE_LAG"  value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><input type="text" size=3 id="AIA_Alert"  value="&nbsp;" style="background-color:#FFFFFF"></TD>
<TD><span id="AIA_lev0_recnum"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
</TR>
<TR>
<TD>&nbsp;</TD>
<TD>&nbsp;</TD>
<TD>T_OBS</TD>
<TD><span id="AIA_lev0_T_OBS"     value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD><span id="AIA_lev0_T_OBS_LAG" value="&nbsp;" style="background-color:#FFFFFF"></span></TD>
<TD>&nbsp;</TD>
</TR>
</TABLE>
<div id="helpwatch">
This section contains summary information about processing XXXX.tlm and level-0 files in the Pipeline system.
Data gets here after is is recieved in the DCS and passed on to the Pipeline system.  Two types of files
are saved in the Pipeline system:  XXXX.tlm contains the raw telemetry data as received from the DDS.  These
files are stored in series named e.g. aia.tlm.  Also the processed level-0 image processing is summarized
here.  These are stored in series named e.g. hmi.lev0.  The times shown above are for the most recent records
stored in the DRMS/SUMS system.  I.e. they only show up here after the ingest_lev0 processing is finished for
the particular tlm file or extracted level-0 image.  Level-0 images are processed in roughly tlm-file-size-groups.
This is presently set to 12 images.  New files will only show up after each batch of 12 images has been
recieved.  This is fewer than the number expected in each one-minute file so the extra lag is small.  Each hour
or so, the ingest_lev0 program flushes any remaining files, closes, then restarts.  At these times an end-of-tlm-file
partial image will be seen as the most recent lev0 image.  When the ingest_lev0 program resumes and gets its next
12 images processed, the first of those 12 will be the completed partial image and the displayed image (below) will
now be complete.  If the most recent image is an isolated image fragment, it will likely be from the tail-end of
an older image and will not have a matching front-end or Image Status Packet.  In these cases the T_OBS time
and DATE keywords will be empty or missing and the computed lag times will likely be NaNs.
<P>
An Alert is provided to call attention to lags longer than desired.
The Alert value is minutes of max lag before turning the Lag to red.  Blinks if lag is 4 times Alert minutes.
<P>
The lag times are computed as the difference between the local machine wall clock and:
<UL><li>tlm filename: the time parsed from the filename.  This time is set at the DDS from the first packet time of the tlm file.
<li>tlm dir_mtime: the last change time of the record directory containing the file.  This shows when the tlm file was processed.  It is useful when the SDO
clock is not set to the current time and the tlm filename times are purposly strange.
<li>lev0 DATE: the time the lev0 image file was written.
<li>lev0 T_OBS: the instrument onboard time when the image was created.
</UL>
</div>
<P>
</DIV>
<DIV id="Details">
<HR>
<div id="helpdetails">
This section shows some keyword values for a range of FSN values.  Click "Update Page" after
changing instrument.  Set First desired FSN and count.  The FSN will be updated with the most
recently processed value when the page is updated.  To examine older data values, turn the automatic update
off before setting the first FSN and do not update the page while examining the older values.
</div>
<TABLE>
<TR><TD width="80">
<form id="InstForm" >
<input  type="radio" id="PickHMI" name="Instrument" value="false" onclick="GetStatus()" >&nbsp;HMI
<BR>
<input  type="radio" id="PickAIA" name="Instrument" value="true" onclick="GetStatus()" >&nbsp;AIA
</form>
</TD><TD>
From FSN =&nbsp;<input type="text" id="DetailsFSN" name="DetailsFSN" value="0" onChange="GetDetailsTable()">
</TD><TD>
Images =&nbsp;<input type="text" id="DetailsCount" name="DetailsCount" value="10" onChange="GetDetailsTable()">
</TD><TD>
<span id="DetailsMsg" value="&nbsp;" ></span>
</TD></TR>
<TR>
<TD> &nbsp; </TD>
<TD>
<span id="DetailsQuery" value="&nbsp;" ></span>
</TD></TR></TABLE>
<span id="DetailsTable" value="&nbsp;" ></span>
</DIV>

<DIV id="Images">
<HR>
<div id="helpimages">
This section shows images for a range of FSN values.  The same rules apply as for the Details section.
</div>
<TABLE>
<TR><TD width="80">
<form id="InstForm2" >
<input  type="radio" id="PickHMI_img" name="Instrument" value="false" onclick="GetStatus()" >&nbsp;HMI
<BR>
<input  type="radio" id="PickAIA_img" name="Instrument" value="true" onclick="GetStatus()" >&nbsp;AIA
</form>
</TD><TD>
From FSN =&nbsp;<input type="text" id="ImagesFSN" name="ImagesFSN" value="0" onChange="GetImagesTable()">
</TD><TD>
Images =&nbsp;<input type="text" id="ImagesCount" name="ImagesCount" value="10" onChange="GetImagesTable()">
</TD><TD>
<span id="ImagesMsg" value="&nbsp;" ></span>
</TD></TR>
<TR>
<TD> &nbsp; </TD>
<TD>
<span id="ImagesQuery" value="&nbsp;" ></span>
</TD></TR></TABLE>
<span id="ImagesTable" value="&nbsp;" ></span>
</DIV>

<DIV id="Display">
<HR>
<div id="helpdisplay">
This section controls a continuing display of recent images on the secondary window.
<P>
The highest FSN of each new segment of data will be colored more boldly to mark the end of the new data.
Note that the FSNs usually alternate between cameras (and thus vitural channels and data files)
so there may be older images alternating with newer ones.
(The AIA images still have the prior shading of grey for the oldest - will be changed if there is interest).
<P>
The logic tries to only update when the contents will
change.  If you change window size or row and col counts and the images does not resize after
one or two Page Updates, try switching instruments then back again.  This should trigger a complete
redraw.  the image size will be set according the the width of the screen and number of columns.  You should
change the screen height or number of rows to make things fit. 
<P>
In auto mode the range of FSN shown is the number that fit in the table ending with the most recent FSN
obtained in the "Watch" section.  In manual mode the rows and cols should be chosen, then set the desired 
starting FSN.  The ending FSN will be computed from the table size.  In manual mode updates change only
the image sizes and completeness, not the FSN choices.
<P>
In Simulated mode, the next 24 images will be fetched each time the page updates.
Use this carefully...
Start by putting into MAnual mode, then enter the starting FSN into the Min FSN field.
Then switch to Sim mode and after a refresh it will start looking like it will during
the mission - except all the FSN will be present and in the real mission each VC will
update independently.
<P>
Each of these images is a link to the small fits files.  If your browser is set-up "right" clicking on
an image will pop-up a DS9 window with the small (512-512) version of the image.  These images have
fully populated FITS headers with values describing the full resolution image.  Be careful where you click!
</div>
<TABLE>
<TR><TD width="80">
<form id="InstForm3" >
<input  type="radio" id="PickHMI_disp" name="Instrument" value="false" onclick="GetStatus()" >&nbsp;HMI
<BR>
<input  type="radio" id="PickAIA_disp" name="Instrument" value="true" onclick="GetStatus()" >&nbsp;AIA
</form>
</TD><TD>
<form id="InstForm4" >
<input  type="radio" id="DisplayAuto" name="Mode" value="false" onclick="SetDisplayMode()" >&nbsp;Auto
<BR>
<input  type="radio" id="DisplayMan" name="Mode" value="true" onclick="ClearDisplayMode()" >&nbsp;Manual
<BR>
<input  type="radio" id="DisplaySim" name="Mode" value="true" onclick="SetSimDisplayMode()" >&nbsp;Simulation
</form>
</TD><TD>
First FSN = &nbsp;<input type="text" id="DisplayMinFSN" name="DisplayMinFSN" value="0" onChange="GetFsnRangeForDisplay()">
<BR> &nbsp; <BR>
Last FSN = &nbsp;<input type="text" id="DisplayMaxFSN" name="DisplayMaxFSN" value="0" onChange="GetFsnRangeForDisplay()">
<BR> &nbsp; <BR>
Sim LSN = &nbsp;<input type="text" id="DisplaySimSN" name="DisplaySimSN" value="0" onChange="GetFsnRangeForDisplay()" >
</TD><TD>
Rows =&nbsp;<input type="text" id="DisplayRows" name="DisplayRows" value="5" onChange="UpdateDisplayTable()">
<BR> &nbsp; <BR>
Cols =&nbsp;<input type="text" id="DisplayCols" name="DisplayCols" value="8" onChange="UpdateDisplayTable()">
</TD></TR>
<TR>
<TD>&nbsp; </TD>
<TD colspan=2>
<span id="DisplayQuery" value="&nbsp;" ></span>
</TD><TD>
<span id="DisplayMessage" value="&nbsp;" ></span>
</TD></TR></TABLE>
</DIV>

<DIV id="footer" style="vertical-align:bottom;text-align:center">
<HR>
<I>Home pages for:</I>
<A HREF = "http://jsoc.stanford.edu/"><B>SDO-JSOC</B></A>
<HR></DIV>
</BODY>
</HTML>

