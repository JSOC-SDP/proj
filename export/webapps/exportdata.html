<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; CHARSET=iso-8859-1">
<TITLE>JSOC Export Data</TITLE>
<SCRIPT TYPE="text/javascript" SRC="js/prototype-1.6.0.3.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/cookies.js"></SCRIPT>
<SCRIPT TYPE="text/javascript" SRC="js/prototip.js"></SCRIPT>
<link rel="stylesheet" type="text/css" href="css/prototip.css" ></link>

<HEAD>

<style type="text/css">

#body { margin:0; padding:0; }
#header { position:relative; top:0; left:0; width:100%; background:#eee; }
#footer { position:fixed; bottom:0; left:0; width:100%; background:#eee; }
#ExportRecordSet { width:40em; font-size:100%; }
span.tip { background-color:yellow }
.prototip { font:0.8em Arial, Helvetica, sans-serif; }
</style>

<script type="text/javascript">

// Global variables and initialize page locations


var SeriesName;
var RequestID;
var RecordSet;
var RecordCount;
var ExportRecordSetOK;
var ExportFromFileList;
var ExportProtocolOK;
var ExportCompressOK;
var ExportMethodOK;
var ExportFilenameFmtOK;
var ExportProcessingOK;
var ExportUserOK;
var ExportNotifyOK;
var ExportReadyOK;
var TipsEnabled;
var TipsCreated = 0;
var args;
var state;
var uploadOndoneAction = 0;
var ExportProcessingArgs = "";

function initVars()
  {
  SeriesName = "";
  RequestID = "";
  RecordSet = "";
  RecordCount = 0;
  ExportRecordSetOK = 0;
  ExportFromFileList = 0;
  ExportProtocolOK = 0;
  ExportCompressOK = 1;
  ExportMethodOK = 0;
  ExportFilenameFmtOK = 0;
  ExportProcessingOK = 0;
  ExportUserOK = 0;
  ExportNotifyOK = 0;
  ExportReadyOK = 0;
  TipsEnabled = 1;
  uploadOndoneAction = 0;
  ExportProcessingArgs = "";

  // if (state < 2)
    {
    $("ExportRequestor").value = "";
    $("ExportProcessing").value = "no_op";
    $("ExportNotify").value = "";
    $("ExportNotifyConf").value = "";
    $("RequestIdPlace").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("StatusLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("TarFileLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("ExportStatus").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("StatusDataLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("ExportRecordSet").value = "";
    $("ExportProtocol").value = "as-is";
    $("ExportCompress").value = "compress Rice";
    $("ExportMethod").value = "url_quick";
    $("ExportFilenameFmt").value = "{seriesname}.{recnum:%lld}.{segment}";
    $("ExportButton").value = "Submit Export Request";
    $("ExportButtonMsg").innerHTML = "Please only click once for export request.";
    $("ExportButton").style.backgroundColor = "#D8D8D8";
    $("RecordSetRow").style.display="table-row";
    $("RecordCountRow").style.display="table-row";
    $("ProcessRow").style.display="none";
    $("ProcessHgPatchCr").style.display="none";
    $("ProcessHgPatchAs").style.display="none";
    $("HgCarrot").style.backgroundColor = "#D88080"; $("HgCarrot").value = "NotSpecified";
    $("HgCRLN").style.backgroundColor = "#D88080"; $("HgCRLN").value = "NotSpecified";
    $("HgCRLT").style.backgroundColor = "#D88080"; $("HgCRLT").value = "NotSpecified";
    $("HgWide").style.backgroundColor = "#D88080"; $("HgWide").value = "NotSpecified";
    $("HgHigh").style.backgroundColor = "#D88080"; $("HgHigh").value = "NotSpecified";
    $("ProtocolRow").style.display="none";
    $("CompressRow").style.display="none";
    $("FilenameFmtRow").style.display="none";
    $("RequestorRow").style.display="none";
    $("NotifyRow").style.display="none";
    $("ConfirmRow").style.display="none";
    $("FileUploadCheckbox").checked = 0;
    $("ExportOpID").value = "exp_request";
    $("ReRequestID").value = "";
    $("ReExportDiv").style.display = "none";
    $("TarFileLocationRow").style.display = "none";
    }
  FileUploadCleanup();
  }

function getargs()
  {
  state = Cookie.getData("state");
  if (state == 1)
    {
    args = Cookie.data["search"].toQueryParams();
    }
  else if (state > 1)
    {
    args = new Object;
    args.ds = "";
    args.requestid = "";
    }
  else
    {
    args = location.search.toQueryParams();
    state=1;
    Cookie.setData("state",state);
    Cookie.setData("search",location.search);
    }
  return args;
  }

function OnLoadInit()
  {
  Cookie.init({name:"exportdata"});
  initVars();
  args = getargs();
  if (args.ds)
    {
    RecordSet = args.ds;
    $("ExportRecordSet").value = RecordSet;
    GetRSCount();
    }
  if (args.id) RequestID = args.id;
  // HELP tips enable
  CreateTips();
  $("TipsOnOffButton").value = "Turn Help Off";
  window.focus();
  }

function ReInitPage()
  {
  Cookie.setData("state",0);
  OnLoadInit();
  }

function CreateTips()
  {
  var tipstyle =
    {
    style:'protoblue',
    hook:{target:'topRight',tip:'bottomLeft'},
    stem:'bottomLeft',
    closeButton:false,
    hideAfter:5,
    hideOn:'click',
    showOn:'click',
    border:3,
    radius:3,
    width:300,
    };
  if (TipsCreated == 0)
    {
    new Tip('RecordFromFileHelp','Allows user to provide a RecordSet list in a file.  ' +
        'The file should contain recordSet specifiers in the format allowed by drms_open_records include files.  ' +
        'See http://jsoc.stanford.edu/jsocwiki/AllAboutJsocNames.',tipstyle);
    new Tip("RecordSetHelp","RecordSet to be exported. May be imported on call and/or may be entered directly here.",tipstyle);
    new Tip("RecordCountHelp","RecordSet record count.  Update this to repeat export with new method, email, etc.",tipstyle);
    new Tip("ProcessingHelp","Processing to be done to the data prior to export.  Select from drop-down list for details.",tipstyle);
    new Tip("HgPatchCrHelp","Extract patch in heliographic coordinates, trac across the disk, provide Carrington location and size of patch in degrees.",tipstyle);
    new Tip("HgPatchAsHelp","Extract a tracked patch specified in arc-sec.  Input data must be a time series with time in first prime key.",tipstyle);
    new Tip("ProtocolHelp",'Data storage protocol for data files to be fetched.  ' +
        '"Fits" causes the data to be converted to full fits files with header information filled from the DRMS records.  ' +
        '"As-is" leaves the data as it is used inside the JSOC DRMS routines, with the header metadata stored in the database ' +
        'rather than with the data file.  "As-is" is faster since the data does not need to be rewritten.',tipstyle);
    new Tip("CompressHelp",'Compression parameters to be used by the cfitsio library.  ' +
        'Provide up to one comma separated string for each segment name in your export.  ' +
        'Use "**NONE**" to indicate uncompressed FITS files desired.  If more segments are to be exported than strings are provided, ' +
        'then the last string will be used repeatedly as needed.  ' +
        'If this parameter is empty, the exported FITS file will have the same compression parameters as the original DRMS ' +
        'series segment as specified in the JSD for that series.  ' +
        'Advice: use **NONE** to ensure uncompressed.  See lookdata.html for the "cparms_sg###" keyword for the default.',tipstyle);
    new Tip("MethodHelp",'Handshake method to be used in the process of doing the export and to fetch the data files. ' +
        '"url-quick" is the fastest but can only be used if the data is online and will be exported "as-is". ' +
        '"url" will result in a temporary directory being created and the URL to that directory be returned to you after ' +
        'a handshake process using the RequestID provided. ' +
        '"ftp" is like "url" but the returned links will be to an ftp directory. ' +
        ' A "-tar" suffix will cause a tar of all files in the request to be included with the separate files. ' +
        'NOTE: do not use "-tar" unless you really need it since that will generate an extra copy of the data.',tipstyle);
    new Tip("FilenameFmtHelp",'Filename format to be used in the process of doing the export.  ' +
        'The filename format is a template used to construct a filename for each segment of each record requested.  ' +
        'The template consists of literal characters and substitution tokens enclosed in "{}".  ' +
        'The special words: seriesname, recnum, and segment are replaced with the series_name, the record number, ' +
        'or the segment name.Any keyword in the record may also be used.  ' +
        'It is wise to include enough of the "prime-keys" to make a unique filename.  ' +
        'The default format template is "{seriesname}.{recnum:%lld}.{segment}" will make unique filenames but prime keys ' +
        'instead of "recnum" may give more useful filenames.',tipstyle);
    new Tip("RequestorHelp","Optional place for your name, this will be used later when we have a way of saving your preferred export options.",tipstyle);
    new Tip("NotifyHelp","Optional email address to be used to notify you when the export is complete and ready to be fetched using the RequestID.",tipstyle);
    new Tip("ConfirmHelp","Usual duplicate copy of email address to avoid lost exports due to typos.",tipstyle);
    new Tip("SendFileHelp","This action will submit the export request with the RecordSet specified in the upload file.",tipstyle);
    }
  TipsCreated = 1;
  $$("span.tip").each(function(showspan){showspan.show();}); 
  }

function HideTips()
  {
  $$("span.tip").each(function(hidespan){hidespan.hide();}); 
  Tips.hideAll();
  }

function ToggleHelp()
  {
  if (TipsEnabled)
    {
    HideTips();
    $("TipsOnOffButton").value = "Turn Help On";
    TipsEnabled = 0;
    }
  else
    {
    CreateTips();
    $("TipsOnOffButton").value = "Turn Help Off";
    TipsEnabled = 1;
    }
  }

function FileUploadCleanup()
  {
  RecordSet = "";
  $("ExportRecordSet").value = RecordSet;
  ExportRecordSetOK = 0;
  ExportFromFileList = 0;
  $("FileUploadCheckbox").checked = 0;
  $("RSCountPlace").innerHTML = "";
  $("ExportButton").value = "Submit Export Request";
  $("AjaxExportRequestRow").style.display="table-row";
  $("FileUploadInfoRow").style.display="none";
  $("RecordSetRow").style.display="table-row";
  $("RecordCountRow").style.display="table-row";
  $("ExportOpID").value = "exp_request";
  }
  
function FileUploadWanted()
  {
  if (ExportFromFileList == 0)
    {
    RecordSet = "*file*";
    $("ExportRecordSet").value = RecordSet;
    ExportRecordSetOK = 1;
    ExportFromFileList = 1;
    $("FileUploadCheckbox").checked = 1;
    $("RecordSetRow").style.display="none";
    $("RecordCountRow").style.display="none";
    $("ExportOpID").value = "exp_request";
    $("FileUploadRow").style.display="table-row";
    $("FileUploadInfoRow").style.display="none";
    $("AjaxExportRequestRow").style.display="none";
    }
  else
    {
    $("FileUploadInfoRow").style.display="none";
    FileUploadCleanup();
    FinishFileUpload();
    }
  }

function MakeFileUploadRequest()
  {
  if (CheckExportParams() == 0)
    return;
  uploadOndoneAction = 1;
  $("FileUploadFormID").submit();
  }

function uploadDone()
  { //Function will be called when iframe is loaded
  if (uploadOndoneAction == 1)
    {
    var response = window.frames[0].document.getElementsByTagName("body")[0].innerHTML;
    ProcessExportResponse(response);
    uploadOndoneAction = 0;
    }
  }

function FinishFileUpload()
  {
  window.frames[0].document.getElementsByTagName("body")[0].innerHTML = "";
  $("FileUploadRow").style.display="none";
  uploadOndoneAction = 0;
  }

function GetRSCount()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  $("RSCountPlace").innerHTML = "Getting count - wait...";
  RecordCount = -1;
  new Ajax.Request('http://jsoc.stanford.edu/cgi-bin/ajax/jsoc_info',
    {
    method: 'get',
    parameters: {"ds" : RecordSet, "op" : "rs_summary" },

    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status != 0)
        {
	RecordCount = 0;
        $("RSCountPlace").innerHTML = "No RecordSet Count Found";
        }
      else
	{ 
	RecordCount = data.count;
	$("RSCountPlace").innerHTML = data.count;
	}
      ExportReadyOK = 0;
      ExportRecordSetOK = 1;
      $("ExportButtonMsg").innerHTML = "Please only click once for export request.";
      $("ExportButton").value = "Submit Export Request";
      $("ExportButton").style.backgroundColor = "#D8D8D8";
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      },
    onFailure: function() { alert('Something went wrong...'); },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  }

function ExportOpenWin(expURL)
  {
  window.open(expURL,"JSOC_Examine_Export");
  }

var expURL;
function CreateDataTable(data, valuetable)
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  valuetable = "";
  var count = data.count;
  valuetable = "<TABLE BORDER=1>"
  valuetable = valuetable + "<TR><TD>File</TD><TD>Record</TD><TD>Filename</TD></TR>"
  for (ifile=0; ifile < count; ifile++)
    {
    valuetable = valuetable + "<TR>";
    valuetable = valuetable +  "<TD>" + (ifile + 1) + "</TD>";
    valuetable = valuetable +  "<TD>" + data.data[ifile].record + "</TD>";

    thisfile = data.data[ifile].filename;
    expURL = "http://jsoc.stanford.edu" + data.dir + "/" + thisfile;
    // tmp = "<input id=\"ExportFile"+ifile+"\" type=\"text\" value=\""+"http://jsoc.stanford.edu" + data.dir + "/" + thisfile+"\" onClick=\"ExportOpenWin(expURL);\" >";
     tmp = "<A href='" + expURL + "' target='_blank'>" + thisfile + "</A>";

    valuetable = valuetable +  "<TD>" + tmp + "</TD>";
    valuetable = valuetable + "</TR>";
    }
  valuetable = valuetable + "</TABLE>";
  return valuetable;
  }

function ExportNop()
  {
  }

function ExportNewRS()
  {
  RecordSet = $("ExportRecordSet").value;
  GetRSCount();
  }

function SetExportMethod()
  {
  $("ExportMethod").value = $("ExportMethod").value.toLowerCase();
  if ($("ExportMethod").value == "url_quick")
    {
    ExportMethodOK = 1;
    $("ProcessRow").style.display="none";
    $("ProcessHgPatchCr").style.display="none";
    $("ProcessHgPatchAs").style.display="none";
    $("ProtocolRow").style.display="none";
    $("FilenameFmtRow").style.display="none";
    $("CompressRow").style.display="none";
    $("RequestorRow").style.display="none";
    $("NotifyRow").style.display="none";
    $("ConfirmRow").style.display="none";
    }
  else if ($("ExportMethod").value == "url" ||
           $("ExportMethod").value == 'ftp' ||
           $("ExportMethod").value == "url-tar" ||
           $("ExportMethod").value == 'ftp-tar')
    {
    ExportMethodOK = 1;
    $("ProcessRow").style.display="table-row";
    $("ProcessHgPatchCr").style.display="none";
    $("ProcessHgPatchAs").style.display="none";
    $("ProtocolRow").style.display="table-row";
    $("FilenameFmtRow").style.display="table-row";
    $("RequestorRow").style.display="table-row";
    $("NotifyRow").style.display="table-row";
    $("ConfirmRow").style.display="table-row";
    if($("ExportProtocol").value == "FITS")
       $("CompressRow").style.display="table-row";
    }
  else
    {
    alert("Please set Method to url_quick, url, or ftp");
    ExportMethodOK = 0;
    }
  }

function SetExportFilenameFmt()
  {
  if ($("ExportFilenameFmt").value.length != 0)
    ExportFilenameFmtOK = 1;
  else
    {
    alert("Please set non-empty name for FilenameFmt");
    ExportFilenameFmtOK = 0;
    }
  }

function SetProcessing()
  {
  ExportProcessingOK = 0;
  ExportProcessingArgs = "no_op";
  var isok = 0;
  if ($("ExportProcessing").value == "no_op")
    isok = 1;
  else if ($("ExportProcessing").value == "hg_patch_CR")
    {
    $("ProcessHgPatchCr").style.display="table-row";
    if (CheckHgPatchCr())
      isok = 1;
    }
  else if ($("ExportProcessing").value == "hg_patch_AS")
    {
    $("ProcessHgPatchAs").style.display="table-row";
    if (CheckHgPatchAs())
      isok = 1;
    }
  if (isok)
    ExportProcessingOK = 1;
  }

// Processing details for Patch in Carrington Coords
function CheckHgPatchCr()
  {
  var isok = 0;
  ExportProcessingArgs = "hg_patch,";
  if ($("HgCarrot").value == "NotSpecified")
    {
    $("HgCarrot").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgCarrot").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "car_rot=" + $("HgCarrot").value + ",";
    isok += 1;
    }
  if ($("HgCRLN").value == "NotSpecified")
    {
    $("HgCRLN").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgCRLN").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "crln=" + $("HgCRLN").value + ",";
    isok += 1;
    }
  if ($("HgCRLT").value == "NotSpecified")
    {
    $("HgCRLT").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgCRLT").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "crlt=" + $("HgCRLT").value + ",";
    isok += 1;
    }
  if ($("HgWide").value == "NotSpecified")
    {
    $("HgWide").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgWide").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "width=" + $("HgWide").value + ",";
    isok += 1;
    }
  if ($("HgHigh").value == "NotSpecified")
    {
    $("HgHigh").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgHigh").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "height=" + $("HgHigh").value;
    isok += 1;
    }
  return (isok > 0);
  }

// Processing details for Patch in Arc-Sec Coords
function CheckHgPatchAs()
  {
  var isok = 0;
  ExportProcessingArgs = "hg_patch,";
  if ($("HgTRef").value == "NotSpecified")
    {
    $("HgTRef").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgTRef").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "t_ref=" + $("HgTRef").value + ",";
    isok += 1;
    }
  if ($("HgASX").value == "NotSpecified")
    {
    $("HgASX").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgASX").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "asx=" + $("HgASX").value + ",";
    isok += 1;
    }
  if ($("HgASY").value == "NotSpecified")
    {
    $("HgASY").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgASY").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "asy=" + $("HgASY").value + ",";
    isok += 1;
    }
  if ($("HgAsWide").value == "NotSpecified")
    {
    $("HgAsWide").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgAsWide").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "aswide=" + $("HgAsWide").value + ",";
    isok += 1;
    }
  if ($("HgAsHigh").value == "NotSpecified")
    {
    $("HgAsHigh").style.backgroundColor="#D88080";
    isok = 0;
    }
  else
    {
    $("HgAsHigh").style.backgroundColor="#FFFFFF";
    ExportProcessingArgs = ExportProcessingArgs + "ashigh=" + $("HgAsHigh").value;
    isok += 1;
    }
  return (isok > 0);
  }

function SetExportProtocol()
  {
  var tmp = $("ExportProtocol").value.toUpperCase();
  if ($("ExportProtocol").value == "as-is" || tmp == "FITS")
    {
    if (tmp == "FITS")
      {
      $("ExportProtocol").value = "FITS";
      ExportProtocolOK = 2;
      $("CompressRow").style.display="table-row";
      }
    else
      {
      ExportProtocolOK = 1;
      $("CompressRow").style.display="none";
      }
    }
  else
    {
    ExportProtocolOK = 0;
    alert('Export Protocol - must be "as-is" or "FITS"'); 
    $("ExportProtocol").value = "";
    }
  }

function SetExportCompress()
  {
  // No checking for now
  ExportCompressOK = 1;
  }

function SetExportUser()
  {
  if ($("ExportRequestor").value.length != 0)
    ExportUserOK = 1;
  else
    {
    alert("Please set non-empty name for Requestor");
    ExportUserOK = 0;
    }
  }

function SetExportNotify()
  {
  var tmp1 = $("ExportNotify").value.toUpperCase();
  var tmp2 = $("ExportNotifyConf").value.toUpperCase();
  if (tmp1.length == 0)
    {
    ExportNotifyOK = 0;
    alert("Please enter e-mail address in Notify and Confirm fields.");
    return;
    }
  if ( tmp1 == tmp2 )
    {
    if ( tmp1 ==  "SOLARMAIL" )
      ExportNotifyOK = 2;
    else if ( tmp1 == "NONE" || tmp1 == "NO")
      ExportNotifyOK = 3;
    else
      ExportNotifyOK = 1;
    }
  else
    {
    alert("Please enter same e-mail address in both places.");
    ExportNotifyOK = 0;
    }
  }

function CheckExportParams()
  {
  if (ExportRecordSetOK == 0)
    {
    $("ExportButtonMsg").innerHTML = "Retry after RecordSet updated.";
    alert("RecordSet not verified, enter RecordSet then retry export request.");
    return 0;
    }
  SetExportMethod();
  if (ExportMethodOK == 0)
    {
    $("ExportButtonMsg").innerHTML = "Retry after entering export method";
    alert("Method not given, Enter export method then retry export request.");
    return 0;
    }
  SetExportFilenameFmt();
  if (ExportFilenameFmtOK == 0)
    {
    $("ExportButtonMsg").innerHTML = "Retry after entering export method";
    alert("FilenameFmt not given, Enter FilenameFmt then retry export request.");
    return 0;
    }
  SetProcessing();
  if (ExportProcessingOK == 0)
    {
    $("ExportButtonMsg").innerHTML = "Retry after entering processing specs";
    alert("Processing details not correct, fix and retry export request.");
    return 0;
    }
  SetExportProtocol();
  if (ExportProtocolOK == 0)
    {
    $("ExportButtonMsg").innerHTML = "Retry after entering export protocol";
    alert("Protocol not given, Enter export protocol then retry export request.");
    return 0;
    }
  if ($("ExportProtocol").value == "FITS" || $("ExportProtocol").value == "as-is")
    {
    }
  else
    {
    SetExportUser();
    if (ExportUserOK == 0)
      {
      $("ExportButtonMsg").innerHTML = "Retry after entering your identification in Requestor field";
      alert("Requestor not given, Enter name you will use in Requestor field then retry export request.");
      return 0;
      }
    SetExportNotify();
    if (ExportNotifyOK == 0)
      {
      $("ExportButtonMsg").innerHTML = "Retry after entering your e-mail address in Notify field";
      alert("Notify email not given or confirmed, Enter 'solarmail' or 'no' or email address then retry export request.");
      return 0;
      }
    }
  return 1;
  }

function GetExport()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  if (ExportReadyOK == 3)
    {
    alert("Processing request, please wait...");
    return;
    }
  if (CheckExportParams() == 0)
    return;
  if (ExportReadyOK == 0)
    {
    ExportReadyOK = 3;
    state = 2;
    Cookie.setData("state",state);
    $("ExportStatus").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    $("ExportLocation").innerHTML = "";
    $("ExportButtonMsg").innerHTML = "Export request submitted, please wait...";
    $("ExportButton").value = "Processing ...";
    $("ExportButton").style.backgroundColor = "#FFD8D8";
    var protocolparam =  $("ExportProtocol").value;
    if ($("ExportCompress").value.length > 0 && protocolparam == "FITS")
      protocolparam = protocolparam + "," + $("ExportCompress").value;
    var exportparameters = new Hash( {"op" : $("ExportOpID").value,
                 		      "ds" : RecordSet, 
                 		      "process" :  ExportProcessingArgs,
                 		      "requestor" : $("ExportRequestor").value,
                 		      "notify" : $("ExportNotify").value,
                                      "method" : $("ExportMethod").value,
                                      "filenamefmt" : $("ExportFilenameFmt").value,
			 	      "format" : "json",
                 		      "protocol" : protocolparam });
// alert(Object.inspect(exportparameters));
    // if (nsegsselected) exportparameters = exportparameters.merge({"seg": SegList});
    }
  else if (ExportReadyOK == 1)
    {
    var requestidtmp = $("RequestIdPlace").innerHTML;
    var exportparameters = new Hash( {"op" : "exp_status","requestid":requestidtmp});
    }
  else // ExportReadyOK == 2
    {
    $("ExportRecordSet").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
    ExportRecordSetOK = 0;
    alert("Export Request Complete, Please change RecordSet to make another request");
    return;
    }

  new Ajax.Request('http://jsoc.stanford.edu/cgi-bin/ajax/jsoc_fetch',
    {
    method: 'post',
    parameters: exportparameters.toObject(),

    onSuccess: function(transport, json)
      {
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      var response = transport.responseText || "no response text";
      ProcessExportResponse(response);
      },
    onFailure: function()
      {
      $("ExportButtonMsg").innerHTML = "Export Failure, Problem at JSOC facility.";
      ExportReadyOK = 0;
      $("ExportButton").value = "FAILURE ...";
      $("ExportButton").style.backgroundColor = "#FFB0B0";
      alert('Something went wrong...');
      },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  }


function GetReExport()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  ExportReadyOK = 3;
  state = 2;
  Cookie.setData("state",state);
  $("ExportStatus").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  $("ExportLocation").innerHTML = "";
  $("ReExportButtonMsg").innerHTML = "Export request submitted, please wait...";
  $("ReExportButton").value = "Processing ...";
  $("ReExportButton").style.backgroundColor = "#FFD8D8";
  var exportparameters = new Hash( {"op" : "exp_repeat",
                 		    "requestid" : $("ReRequestID").value,
			 	    "format" : "json",
                 		    "notify" : $("ReExportNotify").value });

  new Ajax.Request('http://jsoc.stanford.edu/cgi-bin/ajax/jsoc_fetch',
    {
    method: 'post',
    parameters: exportparameters.toObject(),

    onSuccess: function(transport, json)
      {
      $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
      var response = transport.responseText || "no response text";
      ProcessExportResponse(response);
      },
    onFailure: function()
      {
      $("ReExportButtonMsg").innerHTML = "Export Failure, Problem at JSOC facility.";
      ExportReadyOK = 0;
      $("ReExportButton").value = "FAILURE ...";
      $("ReExportButton").style.backgroundColor = "#FFB0B0";
      alert('Something went wrong...');
      },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  }


function ProcessExportResponse(response)
  {
  var data = response.evalJSON();
  if (data.status == 6)
    {
    alert("RequestID not found, status=6, error=" + data.error + "<BR>Try again in a few seconds, may just be not ready to respond");
    ExportReadyOK = 0;
    $("ExportButton").value = "Retry";
    $("ExportButtonMsg").innerHTML = data.error;
    $("RequestIdPlace").innerHTML = "";
    $("ExportStatus").innerHTML = "RecordSet not found";
    $("ExportLocation").innerHTML = "";
    }
  else if (data.status == 5)
    {
    alert("Requested RequestID is too old, data no longer online, error=" + data.error) ;
    ExportReadyOK = 0;
    $("ExportButton").value = "Export timeout";
    $("ExportButtonMsg").innerHTML = data.error;
    $("RequestIdPlace").innerHTML = "";
    $("ExportStatus").innerHTML = "Export timeout";
    $("ExportLocation").innerHTML = "";
    }
  else if (data.status == 4)
    {
    alert("Requested RecordSet not found or specification error, status=4, error=" + data.error +
      "<BR>The export program failed.<BR>" + "JSOC support see: jsoc/exports/tmp/" + data.requestid + ".runlog");
    ExportReadyOK = 0;
    $("ExportButton").value = "Bad Recordset";
    $("ExportButtonMsg").innerHTML = data.error;
    $("RequestIdPlace").innerHTML = "";
    $("ExportStatus").innerHTML = "RecordSet not found";
    $("ExportLocation").innerHTML = "";
    }
  else if (data.status == 3)
    {
    alert("Requested RecordSet is too large for chosen export method.  Please contact the JSOC for help.");
    $("ExportButtonMsg").innerHTML = "Export Too Large";
    ExportReadyOK = 0;
    $("ExportButton").value = "FAILURE ...";
    $("ExportButton").style.backgroundColor = "#D8D8D8";
    RequestID = data.requestid;
    $("RequestIdPlace").innerHTML = data.requestid;
    $("ExportStatus").innerHTML = "Needs Intervention, size=" + data.size + ", contact: " + data.contact;
    $("ExportLocation").innerHTML = "";
    }
  else if (data.status == 1 || data.status == 2)
    {
    if (data.status == 1)
      $("StatusButtonMsg").innerHTML = "Export request is being processed";
    else  // status==2
      $("StatusButtonMsg").innerHTML = "Export request waiting for processing";
    ExportReadyOK = 1;
    $("ExportButton").value = "Request Export Status";
    $("ExportButton").style.backgroundColor = "#D8D8D8";
    $("ExportStatus").innerHTML = "Processing, size=" + data.size + ", estimate " + data.wait + " seconds remaining";
    RequestID = data.requestid;
    $("RequestIdPlace").innerHTML = data.requestid;
    $("StatusRequestID").value = data.requestid;
    $("ExportLocation").innerHTML = "";
    $("FileUploadInfo").innerHTML = "File upload done, " + data.rcount + " records requested.";
    if (ExportFromFileList == 1)
      {
      FinishFileUpload();
      $("FileUploadInfoRow").style.display="table-row";
      }
    }
  else // status == 0 implies url_quick format and all online as-is
    {
    var valuetable = "";
    var count = data.count;
    $("ExportButtonMsg").innerHTML = "Fetch your data at URLs below before starting next request";
    ExportReadyOK = 2;
    $("ExportButton").value = "Submit Export Request";
    $("ExportButton").style.backgroundColor = "#D8D8D8";
    RequestID = data.requestid;
    if (RequestID.length == 0) RequestID = "N.A.";
    $("RequestIdPlace").innerHTML = RequestID;
    $("ExportStatus").innerHTML = "Data Ready, size=" + data.size;
    valuetable = CreateDataTable(data, valuetable);
    $("ExportLocation").innerHTML =  valuetable + "<BR>";
    $("FileUploadInfo").innerHTML = "File upload done, " + data.rcount + " records requested.";
    if ($("ExportMethod").value == "url_quick")
      {
      if (count > 1)
        {
        $("ExportLocation").innerHTML =  "<B>Multiple files returned, direct fetch not possible. </B><P>" +
          valuetable + "<BR>";
        }
      else
        {
        var path = encodeURI("http://jsoc.stanford.edu" + data.dir + "/" + data.data[0].filename);
//      doucment.write("<link type=\"application/fits\" href="+path+" />");
//      fetch image
        }
      }
    else
      $("ExportLocation").innerHTML =  valuetable + "<BR>";
    if (ExportFromFileList == 1)
      {
      FinishFileUpload();
      $("FileUploadRow").style.display="none";
      $("FileUploadInfoRow").style.display="table-row";
      }
    }
  }

function ClearStatus()
  {
  $("StatusButton").style.backgroundColor = "#D8D8D8";
  $("StatusStatus").innerHTML = "";
  $("StatusValue").innerHTML = "";
  $("StatusOther").innerHTML = "";
  $("StatusButtonMsg").innerHTML = "Waiting new status request...";
  $("StatusButton").value = "Submit Status Request";
  $("StatusRequestID").value = "";
  }

function GetStatus()
  {
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  if ($("StatusRequestID").value.length == 0)
    {
    alert("You must provide a RequestID");
    return;
    }
  $("StatusLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  $("TarFileLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  $("StatusDataLocation").innerHTML = "&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
  $("StatusButton").style.backgroundColor = "#FFD8D8";
  $("StatusStatus").innerHTML = "";
  $("StatusValue").innerHTML = "";
  $("StatusOther").innerHTML = "";
  $("StatusButtonMsg").innerHTML = "Processing status request ...";
  $("StatusButton").value = "Processing ...";
  new Ajax.Request('http://jsoc.stanford.edu/cgi-bin/ajax/jsoc_fetch',
    {
    method: 'get',
    parameters: {"op" : "exp_status", "requestid" : $("StatusRequestID").value }, 

    onSuccess: function(transport, json)
      {
      var response = transport.responseText || "no response text";
      var data = response.evalJSON();
      if (data.status == 6)
        {
        alert("RequestID not found, status=6, error=" + data.error + "<BR>Try again in a few seconds, may just be not ready to respond");
        StatusReadyOK = 0;
        $("StatusButton").value = "Bad Recordset";
        $("StatusButtonMsg").innerHTML = data.error + ", processing perhaps not started yet or bad RequestID";
        $("StatusValue").innerHTML = "Requested RecordSet returned error status=6";
        $("StatusOther").innerHTML = $("StatusRequestID").value + " not found,  msg=" + data.error;
        $("ReExportDiv").style.display = "none";
        }
      else if (data.status == 5)
        {
        alert("Requested RequestID is too old, data no longer online, error=" + data.error);
        ExportReadyOK = 0;
        $("ExportButton").value = "Export timeout";
        $("ExportButtonMsg").innerHTML = data.error;
        $("RequestIdPlace").innerHTML = "";
        $("ExportStatus").innerHTML = "Export timeout";
        $("ExportLocation").innerHTML = "";
        $("ReRequestID").value = data.requestid;
        $("ReExportDiv").style.display = "block";
        }
      else if (data.status == 4)
        {
        alert("Requested RecordSet not found or specification error, status=4, error=" + data.error + "<BR>The export program failed.<BR>" +
		"JSOC support see: jsoc/exports/tmp/" + data.requestid + ".runlog");
        StatusReadyOK = 0;
        $("StatusButton").value = "Bad Recordset";
        $("StatusButtonMsg").innerHTML = data.error;
        $("StatusValue").innerHTML = "Requested RecordSet returned error status=4";
        $("StatusOther").innerHTML = $("StatusRequestID").value + "msg=" + data.error;
        $("ReExportDiv").style.display = "none";
        }
      else if (data.status == 3)
        {
        alert("Requested RecordSet is too large for chosen export method.  Please contact the JSOC for help.");
        $("StatusButtonMsg").innerHTML = "Export Too Large";
        $("StatusButton").value = "FAILURE ...";
        $("StatusButton").style.backgroundColor = "#D8D8D8";
        $("StatusStatus").innerHTML = "Needs Intervention, size=" + data.size + ", contact: " + data.contact;
        $("RequestIdPlace").innerHTML = data.requestid;
        $("StatusValue").innerHTML = "Requested RecordSet returned error status=3";
        $("StatusOther").innerHTML = $("StatusRequestID").value +
           "<BR>The requested RecordSet is too large for chosen export method." +
           "<BR>Please contact the JSOC for help." ;
        $("ReExportDiv").style.display = "none";
        }
      else if (data.status == 1 || data.status == 2)
	{
        if (data.status == 1)
          $("StatusButtonMsg").innerHTML = "Export request is being processed";
        else  // status==2
          $("StatusButtonMsg").innerHTML = "Export request waiting for processing";
        $("StatusButton").value = "Submit Status Request";
        $("StatusButton").style.backgroundColor = "#D8D8D8";
        $("StatusStatus").innerHTML = "Processing, size=" + data.size + ", estimate " + data.wait + " seconds remaining";
        $("RequestIdPlace").innerHTML = data.requestid;
        $("ReExportDiv").style.display = "none";
        }
      else // status == 0
        {
        var valuetable = "";
        $("StatusButtonMsg").innerHTML = "Please only click once for status request.";
        $("StatusButton").value = "Submit Status Request";
        $("StatusButton").style.backgroundColor = "#D8D8D8";
        $("StatusStatus").innerHTML = "Data Ready, size=" + data.size;
        $("RequestIdPlace").innerHTML = data.requestid;
        var StatusLoc;
	if (data.method.indexOf("ftp") >= 0)
          StatusLoc = "ftp://pail.stanford.edu/export" + data.dir + "/";
        else
          StatusLoc = "http://jsoc.stanford.edu" + data.dir + "/";
        $("StatusLocation").innerHTML = "<A HREF='" + StatusLoc + "' target='_blank'>" + StatusLoc + "</A>";
        if (data.method.indexOf("-tar") > 0)
          {
          var tarloc =  StatusLoc + data.requestid + ".tar";
          $("TarFileLocation").innerHTML = "<A HREF='" + tarloc + "'>" + tarloc + "</A>";
          $("TarFileLocationRow").style.display = "table-row";
          }

        $("ExportStatus").innerHTML = "Data Ready, size=" + data.size;
        valuetable = CreateDataTable(data, valuetable);
        $("StatusDataLocation").innerHTML =  valuetable + "<BR>";
        $("StatusValue").innerHTML = "Success";
        $("StatusOther").innerHTML = "List formats are index.html, index.json, and index.txt<BR>" +
             "export script file is " + $("StatusRequestID").value +".drmsrun" ;
        if (ExportFromFileList  == 1)
          FinishFileUpload();
        $("ReExportDiv").style.display = "none";
        }
      },
    onFailure: function()
      {
      $("StatusButtonMsg").innerHTML = "Export Failure, Problem at JSOC facility.";
      $("StatusButton").value = "FAILURE ...";
      $("StatusButton").style.backgroundColor = "#FFB0B0";
      alert('Something went wrong...');
      },
    onComplete: function() { $("AjaxBusy").innerHTML = Ajax.activeRequestCount; }
    });
  $("AjaxBusy").innerHTML = Ajax.activeRequestCount;
  }

</script>

</HEAD>
<BODY BGCOLOR="#E0F0FF" onload="OnLoadInit();" >
<DIV ID="header">
<IMG src="http://hmi.stanford.edu/images/web/JSOC_120.gif"
  style="vertical-align:middle;height:60" alt="JSOC logo">
&nbsp;&nbsp;&nbsp;
<B><big style="vertical-align:middle">&nbsp;&nbsp;JSOC Data Export</big></B>
&nbsp;&nbsp;&nbsp;
&nbsp;&nbsp;&nbsp;
<input type="button" value="reset page" onClick="ReInitPage();" >
&nbsp;&nbsp;&nbsp;
<input id="TipsOnOffButton" type="button" value="Turn Help Off" onClick="ToggleHelp();" >
&nbsp;&nbsp;<span id="AjaxBusy">0</span> Requests Pending
<span id='systemWorking'>, Loading...</span>
<!-- <br clear=all> -->
<HR>
</DIV> <!-- end DIV header -->
<DIV id="ExportRequestDiv">
<B>JSOC Data Export Request Generation</B>
<p>
If the Method is changed from "url_quick" you will have additional options to specify.
<p>
If you enter an email address you will be notified when the data is ready.
<p>
After the request is submitted, you will recieve ON THIS PAGE a "Request_ID" that will be used
to access the data when it is ready.  If you do not provide an email address you must save the Request_ID in order to
access the data.

<form id='FileUploadFormID' name='FileUploadForm'
  action='http://jsoc.stanford.edu/cgi-bin/ajax/jsoc_fetch'
  target="FileUploadFrame"
  enctype='multipart/form-data' method='post'>

<input type='hidden' id='ExportOpID' name='op'  value='exp_request' >

  <TABLE>
    <TR>
      <TD>RecordSet from file</TD><TD><SPAN ID="RecordFromFileHelp" class="tip">?</SPAN></TD>
      <TD colspan=2><input type="checkbox" name="FileUploadCheckbox" id="FileUploadCheckbox" onChange="FileUploadWanted();">
        Check box to allow upload of RecordSet list file, file will be requested after Submit button click.</TD>
    </TR>
  
    <TR ID="RecordSetRow">
      <TD style="width:10em" >RecordSet</TD><TD><SPAN ID="RecordSetHelp" class="tip">?</SPAN></TD><TD colspan=2>
        <input id="ExportRecordSet" type="text" name="ds" value="" onChange="ExportNewRS();" > </TD>
    </TR>
  
    <TR ID="RecordCountRow">
      <TD>Record Count</TD><TD><SPAN ID="RecordCountHelp" class="tip">?</SPAN></TD>
      <TD><span id="RSCountPlace" style="width:10em;background-color:#FFF8DC"></span></TD>
      <TD><input id="CountButton" type="button" value="Recount" onClick="GetRSCount();" ></TD>
    </TR>
  
    <TR ID="MethodRow">
      <TD>Method</TD>
      <TD><SPAN ID="MethodHelp" class="tip">?</SPAN></TD>
      <TD><select id="ExportMethod" type="text" name="method" style="width:15em" onChange="SetExportMethod();" >
        <option value="url_quick">url_quick
        <option value="url">url
        <option value="ftp">ftp
        <option value="url-tar">url-tar
        <option value="ftp-tar">ftp-tar
        </select> </TD>
      <TD>Choose method, url_quick or url for now. url_quick implies protocol of "as-is"</TD>
    </TR>
  
    <TR ID="FilenameFmtRow">
      <TD>Filename Format</TD>
      <TD><SPAN ID="FilenameFmtHelp" class="tip">?</SPAN></TD>
      <TD><input id="ExportFilenameFmt" type="text" name="filenamefmt" value="no_op" style="width:15em" onChange="SetFilenameFmt();" ></TD>
      <TD>Provide file name format, default: "{seriesname}.{recnum:%lld}.{segment}".</TD>
    </TR>
  
    <TR ID="ProcessRow">
      <TD>Processing</TD>
      <TD><SPAN ID="ProcessingHelp" class="tip">?</SPAN></TD>
      <TD><select id="ExportProcessing" type="text" name="exportprocessing" style="width:15em" onChange="SetProcessing();" >
        <option value="no_op">none
        <option value="hg_patch_CR">hg_patch(Carrington)
        <option value="hg_patch_AS">hg_patch(Arc-Sec)
        </select> </TD>
      <TD>Set Pre-export processing info, Trials of tracked patches available.</TD>
    </TR>

    <TR ID="ProcessHgPatchCr">
  
      <TD>HG_Patch</TD>
      <TD><SPAN ID="HgPatchCrHelp" class="tip">?</SPAN></TD>
      <TD>
        <UL>
        <LI><input id="HgCarrot" type="text" name="HgCarrot" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchCr();">&nbsp;CAR_ROT
        <LI><input id="HgCRLN" type="text" name="HgCRLN" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchCr();">&nbsp;CR_LN
        <LI><input id="HgCRLT" type="text" name="HgCRLT" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchCr();">&nbsp;CR_LT
        <LI><input id="HgWide" type="text" name="HgWide" style="width:6em;background-color:#D88080" value="NotSpecified"  onChange="CheckHgPatchCr();">&nbsp;Width(degrees)
        <LI><input id="HgHigh" type="text" name="HgHigh" style="width:6em;background-color:#D88080" value="NotSpecified"  onChange="CheckHgPatchCr();">&nbsp;Height(degrees)
        </UL>
      </TD>
      <TD>Specify patch</TD>
    </TR>
  
    <TR ID="ProcessHgPatchAs">
  
      <TD>HG_Patch</TD>
      <TD><SPAN ID="HgPatchAsHelp" class="tip">?</SPAN></TD>
      <TD>
        <UL>
        <LI><input id="HgTRef" type="text" name="HgTRef" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchAs();">&nbsp;T_REF
        <LI><input id="HgASX" type="text" name="HgASX" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchAs();">&nbsp;EW(arcsec)
        <LI><input id="HgASY" type="text" name="HgASY" style="width:6em;background-color:#D88080" value="NotSpecified" onChange="CheckHgPatchAs();">&nbsp;NS(arcsec)
        <LI><input id="HgAsWide" type="text" name="HgAsWide" style="width:6em;background-color:#D88080" value="NotSpecified"  onChange="CheckHgPatchAs();">&nbsp;Width(arcsec)
        <LI><input id="HgAsHigh" type="text" name="HgAsHigh" style="width:6em;background-color:#D88080" value="NotSpecified"  onChange="CheckHgPatchAs();">&nbsp;Height(arcsec)
        </UL>
      </TD>
      <TD>Specify patch</TD>
    </TR>
  
    <TR ID="ProtocolRow">
      <TD>Protocol</TD>
      <TD><SPAN ID="ProtocolHelp" class="tip">?</SPAN></TD>
      <TD><select id="ExportProtocol" name="protocol" style="width:15em"  onChange="SetExportProtocol();">
        <option value="as-is">as-is <option value="FITS">FITS </select> </TD>
      <TD>Choose protocol, "FITS" or "as-is".</TD>
    </TR>
  
    <TR ID="CompressRow">
      <TD>Compression</TD>
      <TD><SPAN ID="CompressHelp" class="tip">?</SPAN></TD>
      <TD><select id="ExportCompress" name="compress" style="width:15em"  onChange="SetExportCompress();">
        <option value="compress Rice" selected="selected" >compress Rice
        <option value="**NONE**">**NONE** </select> </TD>
      <TD>Choose compression parameters for each segment., **NONE** for no compression.</TD>
    </TR>
  
    <TR ID="RequestorRow">
      <TD>Requestor</TD>
      <TD><SPAN ID="RequestorHelp" class="tip">?</SPAN></TD>
      <TD><input id="ExportRequestor" type="text" name="requestor" value="" onChange="ExportNop();" ></TD>
      <TD>Provide an identifier for you, e.g. your SolarMail name. May be omitted for online delivery.</TD>
    </TR>
  
    <TR ID="NotifyRow">
      <TD>Notify</TD>
      <TD><SPAN ID="NotifyHelp" class="tip">?</SPAN></TD>
      <TD><input id="ExportNotify" type="text" name="notify" value="" onChange="ExportNop();" ></TD>
      <TD>Provide your email address for notification.  May be omitted for online delivery.</TD>
    </TR>
  
    <TR ID="ConfirmRow">
      <TD>Confirm Email</TD>
      <TD><SPAN ID="ConfirmHelp" class="tip">?</SPAN></TD>
      <TD><input id="ExportNotifyConf" type="text" name="notifyconf" value="" onChange="ExportNop();" ></TD>
      <TD>Please confirm e-mail address.</TD>
    </TR>
  
    <TR ID="AjaxExportRequestRow">
      <TD colspan=4>
        <input id="ExportButton" type="button" value="Submit Export Request" style="background-color:#D8D8D8" onClick="GetExport();" >
      <span id="ExportButtonMsg">Please only click once for export request.</span >
      </TD>
    </TR>
  
    <TR id="FileUploadRow" style="display:none;">
      <TD >Select File</TD>
      <TD><SPAN ID="SendFileHelp" class="tip">?</SPAN></TD>
      <TD colspan=2>
      <input type='file' id='newFile' name='file' >
      <input type='button' value='Submit Export Request' class='button' onClick="MakeFileUploadRequest();">
      </TD>
    </TR>

    <TR id="FileUploadInfoRow" style="display:none;">
      <TD>Uploaded File:</TD>
      <TD>&nbsp;</TD>
      <TD><span id="FileUploadInfo"></span></TD>
      <TD></TD>
    </TR>
  </TABLE>
</form>

<DIV ID=iframeHideDiv style="display:none;">
  <iframe id="FileUploadFrame" onload="uploadDone();" name="FileUploadFrame" src="" style="height=0px;width=0px;border:0px solid #fff;"></iframe>
</DIV>

<HR>

<DIV ID=SubmitResponseDiv>
<TABLE>
  <TR>
    <TD>RequestID</TD>
    <TD colspan=2><span id="RequestIdPlace" style="background-color:#FFF8DC;">&nbsp;</span></TD>
    <TD>This is the ID tag for your export request.</TD>
  </TR>

  <TR>
    <TD>Status</TD>
    <TD colspan=3> <span id="ExportStatus" style="background-color:#FFF8DC;"> </span ></TD>
  </TR>

  <TR>
    <TD>Data Location</TD>
    <TD colspan=3><span id="ExportLocation" style="background-color:#FFF8DC;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span ></TD>
  </TR>

</TABLE>
</DIV>
<DIV ExportDataDiv>
<HR>
<TABLE>
  <TR>
    <TD style="width:10em" >RequestID</TD>
    <TD><input type="text" id="StatusRequestID" name="StatusRequestID" style="background-color:#FFF8DC;" value="" onChange="GetStatus();"></TD>
    <TD>This is the ID tag for your export request.</TD>
    <TD><span id="StatusValue">&nbsp;</TD>
  </TR>

  <TR>
    <TD colspan=2 align="center" >
      <input id="StatusButton" type="button" value="Submit Status Request" style="background-color:#D8D8D8" onClick="GetStatus();" ></TD>
    <TD><span id="StatusButtonMsg">Please only click once for status request.</span ></TD>
    <TD rowspan=3><span id="StatusOther">&nbsp;</TD>
  </TR>

  <TR>
    <TD colspan=2 align="center" >
      <input id="ClearButton" type="button" value="Clear Request" style="background-color:#D8D8D8" onClick="ClearStatus();" ></TD>
    <TD>Clear old status RequestID</TD>
  </TR>

  <TR>
    <TD>Status</TD>
    <TD colspan=2> <span id="StatusStatus" style="background-color:#FFF8DC;"> </span ></TD>
  </TR>

  <TR>
    <TD>Data Location</TD>
    <TD colspan=3><span id="StatusLocation" style="background-color:#FFF8DC;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span ></TD>
  </TR>

  <TR ID="TarFileLocationRow" style="display:none;">
    <TD>Tar File Location</TD>
    <TD colspan=3><span id="TarFileLocation"  style="background-color:#FFF8DC;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span ></TD>
  </TR>

  <TR>
  <TD colspan=4><span id="StatusDataLocation" style="background-color:#FFF8DC;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span ></TD>
  </TR>

</TABLE>
</DIV> <!-- id="ExportRequestDiv" -->

<DIV ID="ReExportDiv" style="display:none">
<HR>
Use this section to request a renewal/repeat of a prior export for which the data online-retention time has expired.
<TABLE>

  <TR>
    <TD style="width:10em" >RequestID</TD>
    <TD><input type="text" id="ReRequestID" name="ReRequestID" style="background-color:#FFF8DC;" value="" onChange="ExportNop();"></TD>
    <TD>Enter RequestID for repeat or prior export</TD>
    <TD><span id="ReStatusValue">&nbsp;</TD>
  </TR>

  <TR ID="ReNotifyRow">
    <TD>Notify</TD>
    <TD><input id="ReExportNotify" type="text" name="Renotify" value="" onChange="ExportNop();" ></TD>
    <TD colspan=2>Provide your email address for notification.  May be omitted for online delivery.</TD>
  </TR>
  
  <TR ID="AjaxReExportRequestRow">
    <TD colspan=4>
      re-<input id="ReExportButton" type="button" value="Submit Export Request" style="background-color:#D8D8D8" onClick="GetReExport();" >
    <span id="ReExportButtonMsg">Please only click once for re-export request.</span >
    </TD>
  </TR>
  
</TABLE>
</DIV> <!-- id="ReExportDiv" -->

<HR>
<P style="height:1px">
<DIV id="footer" style="vertical-align:bottom;text-align:center;">
<I>Home page for:</I>
<A HREF = "http://jsoc.stanford.edu/"><B>SDO-JSOC</B></A>
</DIV>
</BODY>
</HTML>
